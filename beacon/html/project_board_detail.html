{{define "layout"}}
<!DOCTYPE html>
<html>

<body>

    {{.}}

    {{ end }}
    {{ template "head"}}
    <title>{{.project_name}} - beacon</title>
    <!-- body -->
    <!-- ======================任务=================== -->
    <!-- <div class="btn-show aa">Type 2</div> -->
    <div id="zhezhao">
    </div>
    <div class="detail_body_all">
        <!-- <form id="task_form" onsubmit="return false" method="post"> -->
        <div class="detail_body_box">
            <div class="detail_body_h">
                <div>
                    <h3>
                        <a class="detail_href" href="#detail_href_m">{{.project_name}}</a>
                        <a id="detail_href_m" class="detail_href"
                            style="text-decoration: none;cursor: pointer;display: none;"
                            onclick="returnff()">{{.project_name}}</a>
                    </h3>

                </div>
                <div style="cursor: pointer;" title="{{.project_note}}" class="detail_body_h_font">
                    项目备注：<label>{{.project_note}}</label>
                </div>
            </div>
            <!-- 人员锚点 -->
            <a href="#details_mmb" class="detail_body_member">
                <span>
                    <div class="detail_body_member_number">0</div>
                </span>
                <span>
                    <div id="" class="detail_body_member_person">
                        <lable>成员</lable>
                    </div>
                </span>
            </a>
            <div id="details_mmb" class="detail_body_member" style="display: none;" onclick="mmmm()">
                <span>
                    <div class="detail_body_member_number">0</div>
                </span>
                <span>
                    <div id="" class="detail_body_member_person">
                        <lable>成员</lable>
                    </div>
                </span>
            </div>

            <!-- 设置锚点 -->
            <a href="#details_set" class="detail_body_Setting">
                <span class="detail_setting_png" style="filter: brightness(20%);">
                    <!-- <div class="detail_setting_png"></div> -->
                    <img style="width: 22px;opacity: 0.5;" src="/img/setgreen.png">
                </span>
                <span>
                    <div class="detail_body_Setting_set">设置</div>
                </span>
            </a>
            <div id="details_set" class="detail_body_Setting" onclick="setssss()" style="display: none;">
                <span class="detail_setting_png">
                    <img src="/img/setting.png">
                </span>
                <span>
                    <a class="detail_body_Setting_set">设置</a>
                </span>
            </div>
            <!-- ============ -->
            <div class="detail_body_line">
                <!-- <img src="/img/line.png"> -->
                <hr>
            </div>

            <div class="details_tttt">
                <div class="detail_body_task">
                    任务
                </div>
                <!--添加任务 -->
                <div class="detail_body_addtask">

                    <span id="d_q_addtaskq">
                        <input onclick="d_q_addtaskq()" class="body_task_add" type="submit" value="添加清单" />
                    </span>
                    <!-- <span>
                            <img class="body_task_time" src="/img/loader.gif">
                        </span> -->
                </div>



                <div class="wd_stand_choose_new">
                    <!-- 筛选 -->
                    <div class="wd_details_screening">

                    </div>

                    <!-- <div class="wd_stand_style"></div> -->
                    <!-- <div style="font-size: 11px;float: left;margin-left: -71px;width: 68px;text-align: right;margin-top: 13px;"  style="display: inline;"></div> -->
                    <div class="detail_body_task_screening">

                        <!-- <div class="detail_body_task_screening_s"> -->
                        <img src="/img/Task screening.png" id="screen" title="筛选"
                            style="width: 22px;position: relative;top: 1px;">


                        <div id="screening_chose" style="display: inline;">
                            <div class="c_screen">
                                <div class="c_sc_name">
                                    任务筛选
                                </div>
                                <div class="c_sc_class">
                                    <div class="c_sc_class_div c_div" onclick="c_sc_class_go()">
                                        <div style="width: 100%;height: 100%;display: flex;align-items: center;">
                                            <div class="c_sc_classname c_sc_lblname"><label for="">任务清单</label></div>
                                            <div style="display: inline-block;">
                                                <img class="c_sc_img class_c_sc_img" src="/img/Task/bottom.png" title="已完成"
                                                    style="width: 16px;">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 任务清单ul -->
                                    <ul name="c_sc_taskclass" id="c_sc_t_class">

                                    </ul>
                                    <!-- 任务的筛选 -->
                                    <div class="c_sc_task_div c_div" onclick="c_sc_task_go()">
                                        <div style="width: 100%;height: 100%;display: flex;align-items: center;">
                                            <div class="c_sc_taskname c_sc_lblname"><label for="">任务负责人</label></div>
                                            <div style="display: inline-block;">
                                                <img class="c_sc_img task_c_sc_img" src="/img/Task/bottom.png" title="已完成"
                                                    style="width: 16px;">
                                            </div>
                                        </div>
                                    </div>
                                    <ul name="c_sc_taskclass" id="c_sc_t_task">
                                        
                                    </ul>
                                    <!-- 标签的筛选 -->
                                    <div class="c_sc_tag_div c_div" onclick="c_sc_tag_go()">
                                        <div style="width: 100%;height: 100%;display: flex;align-items: center;">
                                            <div class="c_sc_tagname c_sc_lblname"><label for="">任务标签</label></div>
                                            <div style="display: inline-block;">
                                                <img class="c_sc_img tag_c_sc_img" src="/img/Task/bottom.png" title="已完成"
                                                    style="width: 16px;">
                                            </div>
                                        </div>
                                    </div>
                                    <ul name="c_sc_tagclass" id="c_sc_t_tag">
                                        
                                    </ul>
                                </div>
                                <div class="c_sc_submit">
                                    <div>
                                        <input onclick="c_sc_sbm()" type="submit" value="提交">
                                    </div>
                                    <div>
                                        <input type="reset" value="取消">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div style="display: inline;color: gainsboro;cursor: default;margin-left: 9px;line-height: 1.5;">
                        |</div>
                    <!-- 分组 -->
                    <div class="wd-stand-per-qufen" style="display: inline;margin-left: 10px;">
                        <div id="wd_stand_fuzeren" style="display: none;">
                            <img title="按负责人分组" src="/img/img/u106.png">
                        </div>
                        <a href="#wd_stand_fuzeren" class="wd_stand_fuzeren" style="display: inline;">
                            <img title="按负责人分组" src="/img/img/u106.png">
                        </a>
                    </div>

                    <div style="display: inline;">
                        <div id="wd_stand_nofen" onclick="wd_nofen()" style="display: none;margin-left: 9px;">
                            <img src="/img/bzview.png" title="不分组" style="width: 16px;">
                        </div>
                        <a href="#wd_stand_nofen" class="wd_stand_nofen" style="display: inline;margin-left: 9px;">
                            <img src="/img/bzview.png" title="不分组" style="width: 16px;">
                        </a>
                    </div>
                    <div style="display: inline;color: gainsboro;cursor: default;margin-left: 9px;line-height: 1.5;">
                        |</div>
                    <div id="wd_sorttimeupdate" style="display: inline;margin-left: 8px;">
                        <img src="/img/img/Reversesort.png" title="任务的预计完成时间从小到大排序" onclick="wd_sortReverse()"
                            style="width: 14px;" alt="">
                    </div>

                </div>
                <!-- //添加任务清单 -->
                <form id="details_body_qingadd" onsubmit="return false" method="post">
                    <div class="details_body_addqingandtask" style="display: none;">
                        <div class="details_body_taskqing">
                            <div>
                                <input type="hidden" name="pid" value="{{.project_gid}}">
                            </div>
                            <div>
                                <input type="hidden" id="details_serial" name="serial">
                            </div>
                            <div class="details_body_taskqing_input">
                                <input type="text" id="wd_d_val" style="width: 80%;height: 22px;" placeholder="输入清单名称"
                                    name="name">
                            </div>
                            <div>
                                <div style="width: 84%;margin: 0 auto;">
                                    <input type="submit" onclick="q_saveandadd()" value="创建清单">
                                    <input type="reset" value="取消" name="" onclick="q_saveand_reset()">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <script>
                    function c_sc_class_go() {
                        $('#c_sc_t_class').slideDown().css('display', 'inline-block')
                        $('.c_sc_class_div').attr('onclick', 'c_sc_class_return()')
                        $('.class_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(0%)',
                            'transform': 'rotate(0deg)'
                        })
                    }
                    function c_sc_class_return() {
                        $('#c_sc_t_class').slideUp()
                        $('.c_sc_class_div').attr('onclick', 'c_sc_class_go()')
                        $('.class_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(100%)',
                            'transform': 'rotate(180deg)'
                        })
                    }

                    function c_sc_task_go() {
                        $('#c_sc_t_task').slideDown().css('display', 'inline-block')
                        $('.c_sc_task_div').attr('onclick', 'c_sc_task_return()')
                        $('.task_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(0%)',
                            'transform': 'rotate(0deg)'
                        })
                    }
                    function c_sc_task_return() {
                        $('#c_sc_t_task').slideUp()
                        $('.c_sc_task_div').attr('onclick', 'c_sc_task_go()')
                        $('.task_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(100%)',
                            'transform': 'rotate(180deg)'
                        })
                    }

                    function c_sc_tag_go() {
                        $('#c_sc_t_tag').slideDown().css('display', 'inline-block')
                        $('.c_sc_tag_div').attr('onclick', 'c_sc_tag_return()')
                        $('.tag_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(0%)',
                            'transform': 'rotate(0deg)'
                        })
                    }
                    function c_sc_tag_return() {
                        $('#c_sc_t_tag').slideUp()
                        $('.c_sc_tag_div').attr('onclick', 'c_sc_tag_go()')
                        $('.tag_c_sc_img').css({
                            'opacity': '1',
                            'filter': 'brightness(100%)',
                            'transform': 'rotate(180deg)'
                        })
                    }
                    function c_sc_sbm() {
                        taskclass()
                        tasktask()
                        tasktag()
                    }
                    //清单筛选
                    function taskclass(){
                        let data = new Array();
                        let v_data = new Array();
                        let class_v = $('.c_sc_classname em')
                        if(class_v.length == '0'){
                            $('.wd_qigndan .stand_qingdan_id').parents('.wd_qigndan').attr('class', 'wd_qigndan')
                        }
                        for (let j = 0; j < class_v.length; j++) {
                            let fff = class_v[j].getAttribute('value');
                           
                            if(fff){
                                data.push(fff)
                            }
                        }
                        let c_class_dom = $('.wd_qigndan .stand_qingdan_id');
                        for(q=0;q<data.length;q++){
                            for (let k = 0; k < c_class_dom.length; k++) {
                                let kkk = c_class_dom[k].getAttribute('value');
                                if(data.indexOf(kkk) <= '-1'){
                                    $('.wd_qigndan .stand_qingdan_id[value="' + kkk+ '"]').parents('.wd_qigndan').attr('class', 'wd_qigndan class_hide')
                                }else{
                                    $('.wd_qigndan .stand_qingdan_id[value="' + kkk+ '"]').parents('.wd_qigndan').attr('class', 'wd_qigndan')
                                }
                            }
                        }
                    }
                    //任务筛选
                    function tasktask(){
                        let data = new Array();
                        let v_data = new Array();
                        let class_v = $('.c_sc_taskname em')
                        if(class_v.length == '0'){
                            $('.wd_stand_alltask .wd_stand_task_hidden').parents('.wd_stand_alltask').attr('class', 'wd_stand_alltask')
                        }
                        for (let j = 0; j < class_v.length; j++) {
                            let fff = class_v[j].getAttribute('value');
                           
                            if(fff){
                                data.push(fff)
                            }
                        }
                        let c_class_dom = $('.wd_qigndan .wd_stand_alltask .wd_stand_task_hidden');
                        for(q=0;q<data.length;q++){
                            for (let k = 0; k < c_class_dom.length; k++) {
                                let kkk = c_class_dom[k].getAttribute('value');
                                if(data.indexOf(kkk) <= '-1'){
                                    $('.wd_stand_alltask .wd_stand_task_hidden[value="' + kkk + '"]').parents('.wd_stand_alltask').attr('class', 'wd_stand_alltask class_hide')
                                }else{
                                    $('.wd_stand_alltask .wd_stand_task_hidden[value="' + kkk + '"]').parents('.wd_stand_alltask').attr('class', 'wd_stand_alltask')
                                }
                            }
                        }
                    }
                   
                    function tasktag(){
                        let data = new Array();
                        let v_data = new Array();
                        let class_v = $('.c_sc_tasktag em')

                        if(class_v.length == '0'){
                            let c_taskall_dom = $('.wd_qigndan .class_hide');
      
                            for (let k = 0; k < c_taskall_dom.length; k++) {
                                if(c_taskall_dom[k]){
                                    // console.log(c_taskall_dom)
                                }
                            }
                        }
                        for (let j = 0; j < class_v.length; j++) {
                            let fff = class_v[j].getAttribute('value');
                            if(fff){
                                data.push(fff)
                            }
                        }
                    }
                    function wd_guheight(i) {
                        $(window).resize(function () {
                            var winHeight = $(window).height();
                           
                            $('#wd-stand-details' + i).css({
                                'height': winHeight  - 210
                            })
                            $('.wd-stand-details').css({
                                'height': winHeight - 210
                            })
                        })
                        var winHeight = $(window).height();
                        $('.wd-stand-details').css({
                            'height': winHeight - 210
                        })
                    }
                    function d_q_addtaskq() {
                        $('.details_body_addqingandtask').slideDown();
                        $('#d_q_addtaskq').html('<input onclick="d_q_addtaskq_return()" class="body_task_add" type="button" value="添加清单" />')
                        $('.body_task_add').css({
                            'color': '#339966'
                        })
                    }
                    function d_q_addtaskq_return() {
                        $('.details_body_addqingandtask').slideUp();
                        $('#d_q_addtaskq').html('<input onclick="d_q_addtaskq()" class="body_task_add" type="button" value="添加清单" />')
                        $('.body_task_add').css({
                            'color': 'rgb(85, 85, 85)'
                        })
                    }
                    function q_saveand_reset() {
                        d_q_addtaskq_return()
                    }
                    function q_saveandadd() {
                        var rrr = new Array();
                        let serial = $('.d_details_serial');
                        for (i = 0; i < serial.length; i++) {
                            let tmpser = serial[i].getAttribute('value')
                            rrr.push(tmpser)
                        }
                        var max = rrr.sort(function (a, b) {
                            return b - a;
                        })[0];
                        let max_ser = ++max
                        $('#details_serial').val(max_ser)

                        let inppt = $('#wd_d_val').val();
                        if ($.trim(inppt) == "") {
                            layer.msg('输入名称不能为空')
                            return false;
                        }
                        $.ajax({
                            url: "/task/class_add",
                            async: false,
                            type: "post",
                            data: $('#details_body_qingadd').serialize(),
                            success: function (result, testStatus, data) {

                                if (result.state == 0) {
                                    layer.msg(result.msg)
                                } else if (result.state == 1) {
                                    let id = data.responseJSON.data
                                    let wd_name = $('#wd_d_val').val();
                                    let state = '1'
                                    let project_task = null;
                                    // let serial = $('#details_serial').val()
                                    let e_ggid = '{{.project_gid}}'
                                    d_q_addtaskq_return()
                                    q_addqing(id, wd_name, max_ser, project_task, allper, adduserMo, alltag, e_ggid)
                                    $('#stand_wd_qingdan' + id).fadeOut().fadeIn();
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }
                    function task_class_save(wd_Id, wd_name, serial) {

                        let inppt = $('#nt_task_class_name' + wd_Id).val();
                        if ($.trim(inppt) == "") {
                            layer.msg('输入名称不能为空')
                            return false;
                        }
                        $.ajax({
                            url: "/task/class_edit",
                            async: false,
                            type: "post",
                            data: $('#nt_taskclass_form' + wd_Id).serialize(),
                            success: function (result, testStatus, data) {
                                if (result.state == 0) {
                                    layer.msg(result.msg)
                                } else if (result.state == 1) {
                                    let name = $('#nt_task_class_name' + wd_Id).val();
                                    $('#d_p_name_class' + wd_Id).html(name).fadeOut().fadeIn()
                                    $('#nt_add_show_classname' + wd_Id).html(name).fadeOut().fadeIn()
                                    d_p_motitask_class_return(wd_Id, name, serial)

                                    mo_class_screen(wd_Id, name)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }
                    function d_p_delect(wd_Id) {
                        layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                            btn: ['是的', '放弃'] //按钮
                        }, function () {
                            $.ajax({
                                url: "/task/class_delete/" + wd_Id,
                                async: false,
                                type: "GET",
                                success: function (data, result, msg, testStatus, state) {
                                    if (data.state == 0) {
                                        layer.msg(data.msg)
                                    } else if (data.state == 1) {
                                        $('#stand_wd_qingdan' + wd_Id).fadeOut();
                                        layer.msg(data.msg)
                                        setTimeout(function () {
                                            $('#stand_wd_qingdan' + wd_Id).remove();
                                        }, 700)

                                        use_class_screen(wd_Id)
                                    }
                                },
                                error: function (xhr, errorMessage, e) {
                                    alert("系统异常");
                                }
                            })
                        }, function () {
                        });
                    }
                    let idd = '{{.project_gid}}'
                    $('#wd_sorttimeupdate').html('<img src="/img/img/Reversesort.png" title="任务的预计完成时间从小到大排序" onclick="wd_sortReverse(\'' + idd + '\')" style="width: 14px;" alt="">')
                </script>



            </div>

            <!-- </form> -->

            <script>
                // 添加任务清单

                $(document).ready(function () {
                    window.onhashchange = getHash();
                });
                function getfenHash() {
                    var hash = window.location.hash;
                    switch (hash) {
                        case '#wd_stand_fuzeren':
                            standfuzeren(arr)
                            // fuzeren_stand() //加载变化
                            break;
                        case '#wd_stand_nofen':
                            wd_nofen()
                            break;
                        default:
                    }
                }
                function getHash() {
                    var hash = window.location.hash;
                    switch (hash) {
                        case '#detail_href_m':
                            returnff();

                            taskcorlr()
                            break;
                        case '#details_mmb':
                            mmmm()
                            usercorlr()
                            break;
                        case '#details_set':
                            setssss()
                            setcorlr()
                            break;
                        default:
                    }
                }

            </script>


            <!-- <div class="task-pinglun">

    </div> -->


            <!-- 按列表显示 -->
            <!-- //任务列表 -->
            <!-- 大框架 -->
            <div class="wd-beacon" style="display: block;clear: both;">
                <!-- 包括任务,长度要长 -->
                <div style="width:100%;margin: 0 auto;">
                    <!-- 里面写任务东西 -->
                    <div class="wd-stand-texiaoy" style="float: left;"></div>
                    <div class="wd-stand-hidden" style="float: left;display: none;width: 100%;">
                        <!-- 子任务 -->
                    </div>
                    <div class="wd-stand-qingdan"></div>
                    <div class="wd-stand-task" style="float: left;"></div>

                    <!-- 已完成任务 -->


                    <div class="wd-body-stand-details">

                    </div>


                </div>
            </div>


            <!-- <div class="wd-stand-chengkai" style="display: block;width:100%;height:80px;clear: both;">
    </div> -->


            <!-- ========================人员========================== -->
            <form id="wd_form" onsubmit="return false" action="##" method="GET">
            </form>
            <script>
                // 人员
                function memberpeo() {
                    $('#wd_form').html('')
                    let member = '<div class="detail_member_body" style="display:none">' +
                        '<div class="detail_member_body_every" >' +
                        '<div>' +
                        '<label>' +
                        '项目创建者' +
                        '</label>' +
                        '</div>' +
                        '<div>' +
                        '<div id="wd_create_at_lbl"></div>' +
                        '</div>' +
                        '</div >' +
                        '<div class="detail_member_body_every">' +
                        '<label for="checkboxall1">项目成员</label>' +
                        '</div>' +
                        '<div id="wd_look_at" class="detail_member_body_every">' +
                        '<label id="wd_look_at_lbl"></label>' +
                        '</div>' +
                        '<div id="cb">' +
                        '</div>' +
                        '<div class="detail_member_body_savemember">' +
                        '<input readonly="readonly" class="wd_save_click" style="color: white;" type="text" value="修改成员 -->">' +
                        '</div>' +
                        '<div class="pro_detail_log">' +
                        '项目变更日志' +
                        '</div>' +
                        '<div class="detail_member_body_member">' +
                        '</div>' +
                        '</div>'
                    $('#wd_form').append(member)
                    xiugaimmb()
                    prolog()
                    setttt()
                    $('.wd-beacon').hide();
                    $('.wd-stand-chengkai').hide();
                    $('.dele_task').hide();
                    $('.wd_add_task').hide();
                    $('.detail_body_info_end').hide();
                    $('.detail_member_body').show();
                    $('.detail_member').hide();
                    $('.detail_setting_body').hide();
                    $('.wd_f_task').hide();
                    $('.task-pinglun').hide();
                    $('.details_tttt').hide();
                    $('.detail_body_member_number').css('color', 'black');
                    $('.detail_body_member_number').css('fontWeight', 'bold');
                    $('.detail_body_member_person').css('color', 'black');
                    $('.detail_body_member_person').css('fontWeight', 'bold');
                    $('.detail_body_Setting_set').css('color', '#aeaaaa');

                    $('.detail_setting_png').css('opacity', '0.5');
                    $('.detail_setting_png').css('filter', 'brightness(20%)');
                    $('.detail_href').css('color', '#aeaaaa');

                }
                function prolog() {
                    $.ajax({
                        url: "/project/log/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        success: function (data, msg, testStatus, result) {
                            let log_tmp = decodeURIComponent(data.data)
                            let log_obj = JSON.parse(log_tmp)
                            if (log_obj != null) {
                                for (i = 0; i < log_obj.length; i++) {
                                    let addtime = log_obj[i].add_time;
                                    let date = addtime.split('+')[0];
                                    let time = addtime.split('+')[1];
                                    let content = log_obj[i].content;

                                    let cont = decodeURIComponent(content.replace(/\+/g, ''));
                                    let cnn = cont.split(':')[1];
                                    let cxn = cnn.split('}')[0];
                                    let cvv = cxn.replace('"', ' ');
                                    let cff = cvv.replace('"', ' ');
                                    $('.detail_member_body_member').append(
                                        '<div id="detail_log_mmb" class="detail_mmb' + i + '">' +
                                        '<div id="detail_member_body_memberchang" class="detail_member' + i + '">' + '</div>' +
                                        '<div id="detail_member_body_recording" class="detail_member_body' + i + '">' +
                                        '<time>' + date + ' ' + decodeURIComponent(time) + '</time>' +
                                        '<div>' +
                                        '<label>' + cff + '</label>' +
                                        '</div>' +

                                        '</div>' +
                                        '</div>'
                                    )
                                }
                            } else {
                                $('.detail_member_body_member').append(
                                    '<div id="detail_log_mmb_else" class="detail_mmb">' +
                                    '项目变更日志为空' +
                                    '</div>'
                                )
                            }


                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }

            </script>



            <!-- ========================设置========================== -->
            <script>


                function setting() {
                    let data = [];//定义一个空数组
                    let str = $('#wd_set_form').serialize();//提取form1里面的所有数据
                    let arr = str.split("&");//切割&
                    let user = [];//定义空数组
                    let tag = [];
                    let length = arr.length;//定义arr的长度
                    for (let i = 0; i < length; i++) {//for循环
                        let tmp = arr[i].split("=");//定义tmp，切割arr[i]的'='
                        if (tmp[0] == 'user') {//如果tmp等于user，
                            user.push(tmp[1]);//push下标
                        } else if (tmp[0] == 'tag') {
                            tag.push(tmp[1]);
                        } else {
                            data.push(arr[i]);
                        }
                    }
                    if (user == '') {
                        data.push("user=");
                    } else {
                        data.push("user='" + user.join("','") + "'");
                    }
                    if (tag == '') {
                        data.push("tag=");
                    } else {
                        data.push("tag=" + tag.join(",") + "");
                    }
                    data = data.join('&');
                    $.ajax({
                        url: "/project/set_submit",
                        async: false,
                        type: "post",
                        data: data,
                        success: function (result, testStatus) {

                            if (result.state == 0) {

                                layer.msg(result.msg)
                            } else if (result.state == 1) {

                                // $('.detail_setting_body_show').css('display', 'block');
                                layer.msg('正在保存设置...')
                                setTimeout(function () {
                                    layer.msg(result.msg)
                                }, 900);
                                setTimeout(function () {
                                    // $('.detail_set_baocun').val(result.msg);
                                    window.location.reload();
                                }, 1500);
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }


            </script>
            <!-- 成员接口 -->


            <form id="wd_set_form" onsubmit="return false" method="POST">
            </form>


            <script>
                function set() {
                    $('#wd_set_form').html('')
                    let sett = ' <div class="detail_setting_body" style="display:none">' +
                        '<div class="detail_setting_body_bottom" style=" float: right;margin-right: 10px;">' +
                        '<div class="detail_setting_body_Archive" onclick="archive()" style="font-size: 13px;cursor: pointer;">' +
                        '项目归档' +
                        '</div>' +
                        '<hr style="margin-top: 5px;">' +
                        '<div class="detail_setting_body_delect" onclick="delect()" style="margin-top: 10px;font-size: 13px;cursor: pointer;">' +
                        '项目删除' +
                        '</div>' +
                        '<hr style="margin-top: 5px;">' +
                        '</div>' +

                        '<div class="detail_setting_body_input">' +
                        '<div>' +
                        '<input type="text" name="id" value="{{.project_gid}}" style="display:none">' +
                        '</div>' +



                        '<div class="">' +
                        '<input class="detail_setting_body_input_1" maxlength="15" name="name" type="text" value="{{.project_name}}" placeholder="项目名称：{{.project_name}}" maxlength="15">' +
                        '</div>' +




                        '<div>' +
                        '<textarea name="note" class="detail_setting_body_input_22" maxlength="121" placeholder="项目备注：">{{.project_note}}</textarea>' +
                        '</div>' +
                        '</div>' +

                        '<div class="detail_setting_body_type">' +
                        '<label class="detail_set_lable">项目类型</label>' +
                        '<div class="detail_setting_body_type_radio2">' +
                        '<input type="radio" name="type" id="radio2" value="2" checked="checked" /><label for="radio2">&nbsp标准项目' +
                        '<label class="lb"></label>更好地组织、细分和管理任务，适用于一般项目管理</label>' +
                        '</div>' +
                        '<div class="detail_setting_body_type_radio" >' +
                        '<input id="radio1" type="radio" name="type" value="1" /><label class="lb" for="radio1">看板项目<label>' +
                        '</label>擅长处理流程化任务，适用于产品研发、用户支持等场景</label>' +
                        '</div>' +

                        '</div>' +
                        '<div class="detail_setting_body_hr1">' +
                        '<hr>' +
                        '</div>' +
                        '<div id="cbox3" class="detail_setting_body_per">' +
                        '<label>项目成员</label>' +
                        '<div class="detail_setting_body_box">' +
                        '<input id="checkboxall3" checked="checked" type="checkbox" />' +
                        '<label for="checkboxall3">所有人</label>' +
                        '<a class="wd_set_chance"> 查看变更日志</a>' +
                        '</div>' +
                        '<div id="wd_project_set" class="detail_setting_body_checkbox" style="margin-left: 25px;">' +

                        '</div>' +
                        '</div>' +
                        '<div>' +
                        '<div>' +
                        '<span>' +
                        '<label id="wd-not-choose">添加未选中人员</label>' +
                        '</span>' +
                        '<p id="wd-not-choose-p">' +
                        '</p>' +
                        '</div>' +
                        '</div>' +
                        '<div class="detail_set_body_lable">' +
                        '<label class="tishi_detail">添加标签&nbsp(<a style="color: red;">注</a>：输入的标签内容在 <strong>6</strong>' +
                        '个字之内)</label>' +
                        '<label class="detail_see">限制六个标签</label>' +
                        '<div class="detail_setting_body_lable_a">' +
                        '</div>' +
                        '</div>' +
                        '<div id="project_tag" class="detail_setting_body_need" style="width: 100%;height: auto;float: left;">' +

                        '<div class="project_system" style="clear: both;float: left;">' +
                        '<div>' +
                        '<div style="float: left;font-size: 12px;">系统标签：</div>' +
                        '</div>' +
                        '<div class="wd_project_system"' +
                        'style="min-width: 70px;height: 25px;line-height: 25px;border-radius: 5px;clear: both;float: left;">' +
                        '<div style="text-align: center;">' +
                        '<input type="text" value="<BUG>" name="tag" readonly="readonly"' +
                        'style="font-size: 14px;color: white;">' +
                        '</div>' +
                        '</div>' +
                        '<div class="wd_project_system_yanchi"' +
                        'style="min-width: 70px;height: 25px;line-height: 25px;border-radius: 5px;float: left;">' +
                        '<div style="text-align: center;">' +
                        '<input type="text" value="<延迟>" name="tag" readonly="readonly"' +
                        'style="font-size: 14px;color: white;">' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '<div class="main" style="clear: both;float: left;width: 98%;padding-bottom: 5px;">' +
                        '<div class="wd-add-tag_new">' +
                        '<div style="float: left;font-size: 12px;margin-top: 10px;">自定义标签：</div>' +
                        '<div style="margin-left: -7px;margin-top: 8px;clear: both;float: left;">' +

                        '<div class="wd_project_add_tag"' +
                        'style="float: left;font-size: 12px;margin-left: 10px;line-height: 2;cursor: pointer;margin-top: 2px;">' +
                        '<div id="wd_project_add_ttag" style="margin-left: 5px;margin-top: 3px;" onclick="newtagg()">添加</div>' +
                        '</div>' +
                        '</div>' +

                        '</div>' +

                        '</div>' +
                        '</div>' +
                        '<hr>' +
                        '<div class="detail_setting_body_button">' +
                        '<div class="detail_setting_body_cancel">' +
                        '<input class="detail_set_baocun" type="submit" value="保存设置" onclick="setting()">' +
                        // '<input class="detail_set_reset" type="reset" value="取消">' +
                        '</div>' +
                        '</div>' +

                        '</div>'

                    $('#wd_set_form').append(sett)
                    setttt()
                    settag()
                    $('.details_tttt').hide();
                    $('.wd-beacon').hide();
                    $('.wd-stand-chengkai').hide();
                    $('.dele_task').hide();
                    $('.detail_body_info_end').hide();
                    $('.wd_add_task').hide();
                    $('.detail_member').hide();
                    $('.detail_member_body').hide();
                    $('.wd_f_task').hide();
                    $('.detail_body_info_red').hide();
                    $('.detail_setting_body').show();
                    $('.task-pinglun').hide();
                    $('.detail_setting_png').css('opacity', '0.9');
                    $('.detail_setting_png').css('filter', 'brightness(20%)');
                    $('.detail_body_Setting_set').css('color', 'black');
                    $('.detail_body_Setting_set').css('fontWeight', 'bold');
                    $('.detail_body_member_person').css('color', '#aeaaaa');
                    $('.detail_body_member_number').css('color', '#aeaaaa');
                    $('.detail_href').css('color', '#aeaaaa');
                    // layer.tips('点击添加自定义标签', '#wd_project_add_ttag');
                    chakanrizhi()
                    // project_tag_add()
                }
                function setttt() {
                    $('#wd_create_at_lbl').html('')
                    $('#wd_look_at_lbl').html('')
                    $.ajax({
                        url: "/project/member/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        // data: $('#wd_form').serialize(),
                        success: function (data, result, testStatus) {
                            let obj = decodeURIComponent(data.data.add_user);
                            obj = JSON.parse(obj);
                            for (k in obj) {
                                let name = decodeURIComponent(obj[k])
                                let username = k;
                                mmber = k;
                                mmber_name = name;
                                $('#wd_create_at_lbl').append('<a href="/team/member/' + mmber + '">' + mmber_name + '</a>')
                                group3 = decodeURIComponent(data.data.add_user);
                                // adduserMo.push(k + ',' + name)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                    $.ajax({
                        url: "/project/member/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        // data: $('#wd_form').serialize(),
                        success: function (data, result, testStatus) {
                            if (data && data.data.mmb_user) {
                                let mmmuser = decodeURIComponent(data.data.mmb_user).replace(/{/g, '')
                                let mmbobj = mmmuser.replace(/}/g, '')
                                if (decodeURIComponent(data.data.mmb_user) != '{}') {
                                    var gdata = JSON.parse(decodeURIComponent(data.data.mmb_user)).map(item => {
                                        let itemKey = Object.keys(item)[0];//注释
                                        return {
                                            gid: itemKey,
                                            name: item[itemKey]
                                        };
                                    });

                                    for (var i = 0; i < gdata.length; i++) {

                                        adduser = decodeURIComponent(gdata[i].gid);
                                        addname = decodeURIComponent(gdata[i].name);
                                        // add.push(adduser + ',' + addname);
                                        $('#wd_look_at_lbl').append('<a style="padding-right: 10px;" href="/team/member/' + adduser + '">' + addname + '</a>')
                                        $('#wd_project_set').append('<span>' + '<input id="wd_project_set_inp' + i + '" name="user" type="checkbox" value=' + gdata[i].gid + ' class="wd_set_cbx11">' +
                                            '<input style="display:none;" class="wd_pro_ttmp" id="wd_pro_tmp' + i + '" name="user" type="checkbox" value="1">' +
                                            '<label for="wd_project_set_inp' + i + '" id="wd_set_span">' + decodeURIComponent(gdata[i].name) + '</label>' + '</span>');
                                        group1 = decodeURIComponent(JSON.stringify(gdata));
                                        let memmbergid = decodeURIComponent(gdata[i].gid);
                                        let memmber = decodeURIComponent(gdata[i].name)
                                        mmb_all.push(gdata[i].gid)
                                        // adduserMo.push(memmbergid + ',' + memmber)



                                        $('#checkboxall3').click(function () {
                                            if (this.checked) {
                                                $('.wd_set_cbx11').prop('checked', true)
                                            } else {
                                                $('.wd_set_cbx11').prop('checked', false)
                                            }
                                        })
                                        mmbernewbigcbx(i)
                                    }

                                } else {
                                    group1 = '';
                                    $('#wd_look_at_lbl').append('无');
                                    $('#wd_project_set').append('暂无');
                                    $('#checkboxall3').attr('checked', false);
                                }


                            } else {
                                alert('获取成员失败')
                            }

                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }

                    })
                    function mmbernewbigcbx(i) {

                        let qrr = $('#wd_project_set .wd_set_cbx11');
                        qrr.prop('checked', true)
                        $('#wd_project_set_inp' + i).click(function () {
                            if (this.checked) {
                                $('#wd_pro_tmp' + i).val('1')
                            } else {
                                $('#wd_pro_tmp' + i).val('0')
                            }
                            paintos()
                        })
                        $('#checkboxall3').click(function () {
                            if (this.checked) {
                                $('#wd_pro_tmp' + i).val('1')
                            } else {
                                $('#wd_pro_tmp' + i).val('0')
                            }
                        })

                    }
                    function paintos() {
                        var rrr = new Array();
                        let arr = $('#wd_project_set .wd_pro_ttmp');
                        for (let j = 0; j < arr.length; j++) {
                            rrr.push(arr[j].getAttribute('value'));
                        }
                        let index = rrr.indexOf('0');
                        if (index == -1) {
                            $('#checkboxall3').prop('checked', true)
                        } else {
                            $('#checkboxall3').prop('checked', false)
                        }
                        return index
                    }
                    // $('.detail_body_member_number').html(mmb_all.length)
                    $.ajax({
                        url: "/member/all",
                        async: false,
                        type: "GET",
                        data: $('#form2').serialize(),
                        success: function (data, result, testStatus) {

                            if (data && data.data && data.data.length) {

                                var pdata = data.data.map(item => {

                                    // data.data.map(item=>`'${item}'`).join();
                                    let itemKey = Object.keys(item)[0];//注释
                                    // var d =JSON.stringify(pdata);
                                    return {
                                        gid: itemKey,
                                        name: item[itemKey]
                                    }
                                })
                                let all = [];
                                for (var i = 0; i < pdata.length; i++) {
                                    // var bbb = decodeURIComponent([pdata[i].gid])
                                    group2 = decodeURIComponent(JSON.stringify(pdata));
                                    all_id = pdata[i].gid
                                    all_name = decodeURIComponent(pdata[i].name)


                                }
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })

                    let two = JSON.parse(group2)
                    let three = JSON.parse(group3)

                    //vis可视接口去重
                    if (group1 != '') {
                        let a = JSON.parse(group1);
                        let b = JSON.parse(group2);
                        let c = [];
                        for (let i = 0; i < b.length; i++) {
                            let ok = true;

                            for (let j = 0; j < a.length; j++) {
                                if (a[j].gid == b[i].gid) {
                                    ok = false;
                                }
                            }
                            if (ok) {
                                c.push(b[i]);
                            }
                        }
                        let d = JSON.parse(group3);
                        let vis = [];

                        for (let i = 0; i < c.length; i++) {

                            let ok = true;
                            for (k in d) {

                                if (k == c[i].gid) {
                                    ok = false;
                                }
                            }
                            if (ok) {
                                vis.push(c[i]);
                            }
                        }
                        let obj = vis;
                        for (k in obj) {
                            $('#wd-not-choose-p').append('<span>' + '<input id="wd_project_set_input' + k + '"name="user" type="checkbox" value=' + obj[k].gid +
                                ' class="wd_set_cbx">' + '<label for="wd_project_set_input' + k + '"  style="cursor: pointer;" id="wd_all_span">' + obj[k].name + '</label>' + '</span>');


                        }
                        //vis可视接口去重
                    } else {
                        let pps = [];
                        for (v = 0; v < two.length; v++) {
                            let okey = true;
                            for (g in three) {
                                if (g == two[v].gid) {
                                    okey = false;
                                }
                            }
                            if (okey) {
                                pps.push(two[v]);

                            }
                        }

                        for (k in pps) {
                            $('#wd-not-choose-p').append('<span>' + '<input id="wd_project_set_input"name="user" type="checkbox" value=' + pps[k].gid +
                                ' class="wd_set_cbx">' + '<lable for="wd_project_set_input"  id="wd_all_span">' + pps[k].name + '</lable>' + '</span>');
                            let usergid = pps[k].gid;
                            let username = pps[k].name
                        }

                    }
                }

                function delect() {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/project/delete/{{.project_gid}}",
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    layer.msg(data.msg)
                                    window.location = "/project/list";
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }

                function archive() {
                    layer.confirm('您真的确定要归档吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/project/archive/{{.project_gid}}",
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    layer.msg(data.msg)
                                    window.location = "/project/list";
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }

                function settag() {
                    $.ajax({
                        url: "/project/tag/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        success: function (data, result, testStatus) {
                            let task_tag = decodeURIComponent(data.data)
                            let stand_tag = task_tag.split(',');
                            for (i = 0; i < stand_tag.length; i++) {
                                let tag = '<div id="wd_project_custom' + i + '" class="wd_project_custom" style="min-width: 100px;height: 25px;line-height: 27px;border-radius: 5px;float: left;">' +
                                    '<div>' +
                                    '<input id="wd_project_inputtag' + i + '" readonly="readonly" type="text" name="tag" maxlength="6" value="' + stand_tag[i].replace(/\+/g, ' ') + '" style="cursor: default;font-size: 14px;color: white;line-height: 21px;height:15px;">' +
                                    '<i class="wd_project_system_i" style="margin-top: -2px;float: right;cursor: pointer;">x</i>' +
                                    '</div>' +
                                    '</div>'
                                $('.wd_project_add_tag').before(tag)
                                if (stand_tag[i] == '<BUG>' || stand_tag[i] == '<延迟>') {
                                    $('#wd_project_custom' + i).remove();
                                }
                                if ($('#tag_set' + i).val() == $('#tag_seting').val()) {
                                    $('.tag_name' + i).remove();
                                }
                                if ($('#wd_project_inputtag' + i).val() == '' || $('#wd_project_inputtag' + i).val() == ' ') {
                                    $('#wd_project_custom' + i).remove();
                                    // layer.msg('标签不能为空');
                                    // return false;
                                }
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                $(document).on('click', '#img0_set', function () {
                    $(this).parent().remove();
                })






                var mmber;
                var mmber_name;
                var adduser;
                var addname;
                var add = [];
                var mmb_all = [];

                // 新
                let allper = [];
                let adduserMo = [];
                let mmb_user = [];

                $(document).ready(function () {
                    $.ajax({
                        url: "/project/member/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        // data: $('#wd_form').serialize(),
                        success: function (data, result, testStatus) {
                            let obj = decodeURIComponent(data.data.add_user);
                            obj = JSON.parse(obj);
                            for (k in obj) {
                                let name = decodeURIComponent(obj[k])
                                let username = k;
                                mmber = k;
                                mmber_name = name;
                                $('#wd_create_at_lbl').append('<p class="peoject_add_user">' + name + '</p>');

                                group3 = decodeURIComponent(data.data.add_user);
                                mmb_all.push(mmber)
                                adduserMo.push(k + ',' + name)
                            }
                            if (data && data.data.mmb_user) {
                                let mmmuser = decodeURIComponent(data.data.mmb_user).replace(/{/g, '')
                                let mmbobj = mmmuser.replace(/}/g, '')
                                if (decodeURIComponent(data.data.mmb_user) != '{}') {
                                    var gdata = JSON.parse(decodeURIComponent(data.data.mmb_user)).map(item => {
                                        let itemKey = Object.keys(item)[0];//注释
                                        return {
                                            gid: itemKey,
                                            name: item[itemKey]
                                        };
                                    });

                                    for (var i = 0; i < gdata.length; i++) {

                                        adduser = decodeURIComponent(gdata[i].gid);
                                        addname = decodeURIComponent(gdata[i].name);
                                        // add.push(adduser + ',' + addname);
                                        $('#wd_look_at_lbl').append('<span class="wd_look_span" style="margin-left: 5px;">' + decodeURIComponent(gdata[i].name) + '</span>');
                                        $('#wd_project_set').append('<span>' + '<input id="wd_project_set_input' + i + '" name="user" checked="checked" type="checkbox" value=' + gdata[i].gid + ' class="wd_set_cbx">' +
                                            '<lable for="wd_project_set_input' + i + '" id="wd_set_span">' + decodeURIComponent(gdata[i].name) + '</lable>' + '</span>');
                                        group1 = decodeURIComponent(JSON.stringify(gdata));
                                        let memmbergid = decodeURIComponent(gdata[i].gid);
                                        let memmber = decodeURIComponent(gdata[i].name)
                                        mmb_all.push(gdata[i].gid)
                                        adduserMo.push(memmbergid + ',' + memmber)
                                    }

                                } else {
                                    group1 = '';
                                    $('#wd_look_at_lbl').append('无');
                                    $('#wd_project_set').append('暂无');
                                    $('#checkboxall3').attr('checked', false);
                                }


                            } else {
                                alert('获取成员失败')
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                    $('.detail_body_member_number').html(mmb_all.length)
                    $.ajax({
                        url: "/member/all",
                        async: false,
                        type: "GET",
                        data: $('#form2').serialize(),
                        success: function (data, result, testStatus) {

                            if (data && data.data && data.data.length) {

                                var pdata = data.data.map(item => {

                                    let itemKey = Object.keys(item)[0];//注释
                                    return {
                                        gid: itemKey,
                                        name: item[itemKey]
                                    }
                                })
                                let all = [];
                                for (var i = 0; i < pdata.length; i++) {
                                    // var bbb = decodeURIComponent([pdata[i].gid])
                                    group2 = decodeURIComponent(JSON.stringify(pdata));
                                    all_id = pdata[i].gid
                                    all_name = decodeURIComponent(pdata[i].name)

                                    // all
                                    allper.push(all_id + ',' + all_name)
                                    // all[all_id] = all_name

                                }
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })

                    let two = JSON.parse(group2)
                    let three = JSON.parse(group3)

                    //vis可视接口去重
                    if (group1 != '') {

                        let a = JSON.parse(group1);
                        let b = JSON.parse(group2);
                        let c = [];
                        for (let i = 0; i < b.length; i++) {
                            let ok = true;

                            for (let j = 0; j < a.length; j++) {

                                if (a[j].gid == b[i].gid) {
                                    ok = false;
                                }
                            }
                            if (ok) {
                                c.push(b[i]);
                            }
                        }
                        let d = JSON.parse(group3);
                        let vis = [];

                        for (let i = 0; i < c.length; i++) {

                            let ok = true;
                            for (k in d) {

                                if (k == c[i].gid) {
                                    ok = false;
                                }
                            }
                            if (ok) {
                                vis.push(c[i]);
                            }
                        }
                        let obj = vis;
                        for (k in obj) {
                            // $('#wd-not-choose-p').append('<span>' + '<input id="wd_project_set_input'+k+' "name="user" type="checkbox" value=' + obj[k].gid +
                            //     ' class="wd_set_cbx">' + '<lable for="wd_project_set_input'+k+'"  id="wd_all_span">' + obj[k].name + '</lable>' + '</span>');


                        }
                        //vis可视接口去重
                    } else {
                        let pps = [];
                        for (v = 0; v < two.length; v++) {
                            let okey = true;
                            for (g in three) {
                                if (g == two[v].gid) {
                                    okey = false;
                                }
                            }
                            if (okey) {
                                pps.push(two[v]);

                            }
                        }

                        for (k in pps) {

                            $('#wd-not-choose-p').append('<span>' + '<input id="wd_project_set_input "name="user" type="checkbox" value=' + pps[k].gid +
                                ' class="wd_set_cbx">' + '<lable for="wd_project_set_input"  id="wd_all_span">' + pps[k].name + '</lable>' + '</span>');
                            let usergid = pps[k].gid;
                            let username = pps[k].name
                        }

                    }
                })
                $(document).ready(function () {
                    $.ajax({
                        url: "/project/tag/{{.project_gid}}",
                        async: false,
                        type: "GET",
                        success: function (data, result, testStatus) {
                            let task_tag = decodeURIComponent(data.data)
                            let stand_tag = task_tag.split(',');
                            for (i = 0; i < stand_tag.length; i++) {
                                // $('.main').append('<span id="tag_name-bug" class="tag_name' + i + '" style="background-color: rgba(153, 51, 204, 1);">' +
                                //     '<input id="tag_set' + i + '" value="' + stand_tag[i] + '" maxlength ="8" name="tag">' + '<i class="img_set_xx" id="img0_set">x</i>' + '<span>')
                                // let tag = '<div id="wd_project_custom' + i + '" class="wd_project_custom" style="min-width: 100px;height: 25px;line-height: 27px;border-radius: 5px;float: left;">' +
                                //     '<div>' +
                                //     '<input type="text" name="tag" value="' + stand_tag[i] + '" style="font-size: 14px;color: white;">' +
                                //     '<i class="wd_project_system_i" style="margin-top: -2px;float: right;cursor: pointer;">x</i>' +
                                //     '</div>' +
                                //     '</div>'
                                // $('.wd_project_add_tag').before(tag)
                                if (stand_tag[i] == '<BUG>' || stand_tag[i] == '<延迟>') {
                                    $('#wd_project_custom' + i).remove();
                                }
                                if ($('#tag_set' + i).val() == $('#tag_seting').val()) {
                                    $('.tag_name' + i).remove();
                                }
                                let stand_ttag = stand_tag[i].replace(/\+/g, ' ')
                                // 添加任务下的标签处理函数
                                wd_task_add(stand_ttag, i)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                })
                var alltag = [];
                function wd_task_add(stand_ttag, i) {
                    alltag.push(stand_ttag)
                }
                document.onreadystatechange = subSomething;//当页面加载状态改变的时候执行这个方法.
                function subSomething() {
                    // let me = '<div style="width: 100%;height: 100%;margin: 0 auto;text-align: center;"><img src="/img/blue_begin.png"></div>'
                    if (document.readyState != "complete") {
                        $('#zhezhao').css('display', 'block');
                        $('#zhezhao').css('z-index', '555')
                    } else {

                    }

                }
                $(document).ready(function () {
                    $('#zhezhao').css('display', 'block');
                    task_beacon()
                })
                // 如果有已完成任务。则显示已完成图片
                function task_finish_new_hide() {
                    // 任务下有已完成，没有其他任务时
                    var obj = $('.wd-stand-task');
                    if (!$.trim(obj.html())) {
                        // $('.wd-stand-task').html('<div id="wd-stand-divdiv" style="width: 100%;margin: 0 auto;text-align: center;font-size: 12px;">暂时没有更多任务</div>')
                    } else {
                        // $('#wd_beacon_task_finish').show();
                    }
                }
                function task_beacon() {
                    $.ajax({
                        url: "/project/task/{{.project_gid}}",
                        type: 'GET',
                        beforeSend: function () {
                            $('#zhezhao').css('display', 'block')
                            loading.showLoading({
                                type: 1,
                                tip: "加载中..."
                            })
                            $('.load-view').css('top', '-273px');
                            $('.load-view').css('z-index', '666');
                            $('#zhezhao').css('z-index', '555')
                        },
                        success: function (data) {
                            let task = decodeURIComponent(data.data)
                            let wd_task = JSON.parse(task);
                            if (wd_task != null) {

                                var gid = '{{.project_gid}}';

                                beacon(wd_task, allper, adduserMo, alltag, gid)
                                task_finish_new_hide()
                            } else {
                                alert('出现错误')
                            }
                        },
                        complete: function () {
                            $('#zhezhao').css('display', 'none');
                            loading.hideLoading();
                        },
                        error: function (xhr, errorMessage, e) {
                            alert(e);
                        }

                    });
                }

                function addtask(wd_Id) {
                    let inppt = $('#wd_name_task_input' + wd_Id).val();
                    if ($.trim(inppt) == "") {
                        layer.msg('输入名称不能为空')
                        return false;
                    }
                    let dataa = [];
                    let auser = [];
                    let str = $('#nt_addtask_form' + wd_Id).serialize();
                    let arr = str.split('&');
                    for (i = 0; i < arr.length; i++) {
                        let tmp = arr[i].split('=');
                        if (tmp[0] == 'tag') {
                            auser.push(tmp[1]);
                        } else {
                            dataa.push(arr[i])
                        }
                    }
                    dataa.push("tag=" + auser);
                    dataa = dataa.join('&');
                    $.ajax({
                        url: "/task/add",
                        async: false,
                        type: "post",
                        data: dataa,
                        success: function (result, testStatus, data) {
                            if (result.state == 0) {
                                // addtaskhref(dataa)
                                layer.msg(result.msg)
                            } else if (result.state == 1) {
                                let ctid = data.responseJSON.data.tgid;
                                $('#wd-stand-divdiv' + wd_Id).remove();
                                addtaskhref(wd_Id, dataa, ctid, allper, adduserMo, alltag)
                                $('#wd-stand-divdiv').remove();
                                layer.msg(result.msg)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }

                // 项目下任务修改
                function taskMotify(M) {
                    let inppt = $('#wd_Modify_name' + M).val();
                    if ($.trim(inppt) == "") {
                        layer.msg('输入名称不能为空')
                        return false;
                    }
                    let datam = [];
                    let auser = [];
                    let str = $('#Modity' + M).serialize();

                    let arr = str.split('&');
                    for (i = 0; i < arr.length; i++) {
                        let tmp = arr[i].split('=');
                        if (tmp[0] == 'tag') {
                            auser.push(tmp[1]);
                        } else {
                            datam.push(arr[i])
                        }
                    }
                    datam.push("tag=" + auser);
                    datam = datam.join('&');
                    $.ajax({
                        url: "/task/edit",
                        async: false,
                        type: "post",
                        data: datam,
                        success: function (result, testStatus, data) {
                            if (result.state == 0) {
                                layer.msg(result.msg)
                            } else if (result.state == 1) {
                                tmpmotask(datam, M, allper, adduserMo)

                                // $('.wd-stand-task').html('')
                                // $('.wd-body-stand-details').html('')
                                // task_beacon()
                                layer.msg(result.msg)
                            }

                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                // 详细页面下任务修改
                function wd_stand_detail_save(i) {
                    let datam = [];
                    let auser = [];
                    let str = $('#wd-stand-details-form' + i).serialize();
                    let arr = str.split('&');

                    for (t = 0; t < arr.length; t++) {
                        let tmp = arr[t].split('=');
                        if (tmp[0] == 'tag') {
                            auser.push(tmp[1]);
                        } else {
                            datam.push(arr[t])
                        }
                    }
                    datam.push("tag=" + auser);
                    datam = datam.join('&');
                    $.ajax({
                        url: "/task/edit",
                        async: false,
                        type: "post",
                        data: datam,
                        success: function (result, testStatus, data) {
                            if (result.state == 0) {
                                layer.msg(result.msg)
                            } else if (result.state == 1) {
                                tmpmodedetailstask(datam, i, allper)
                                // $('.wd-stand-details').css('pointer-events', 'none');
                                // wd_loadding()
                                // // $('.wd-stand-details').css('pointer-events', '');
                                // setTimeout(function () {
                                //     $('.wd-stand-details').css('pointer-events', '');
                                // }, 1000)
                                layer.msg(result.msg)
                            }

                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                // 详细页面下任务删除
                function wd_stand_detail_delect(beaocn_id, i) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/delete/" + beaocn_id,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    window.history.back();
                                    $('.details_tttt').show();
                                    $('#wd-stand-details' + i).hide();
                                    $('.detail_member').fadeIn();
                                    $('.wd-stand-task').fadeIn();
                                    $('.wd-stand-hidden').fadeIn();

                                    //                                 $('.wd-stand-task-name' + i).css('text-decoration', 'line-through red')
                                    //                                 $('#pause' + i + ' img').css('-webkit-filter', 'grayscale(100%)')
                                    //                                 $('#wd-stand-alltask' + i).css('animation', 'fade 600ms infinite')
                                    $('#wd-stand-alltask' + i).remove();
                                    var obj = $('.wd-stand-task');
                                    if (!$.trim(obj.html())) {
                                        $('.wd-stand-task').html('<div id="wd-stand-divdiv" style="width: 100%;margin: 0 auto;text-align: center;font-size: 12px;">暂时没有更多任务</div>')
                                    } else {
                                        // $('#wd_beacon_task_finish').show();
                                    }

                                    layer.msg(data.msg)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }
                function wd_member_task_showhide(i) {
                    $('#wd-stand-details' + i).hide();
                    $('.detail_member').show();
                    $('.wd-stand-task').show();
                    $('.wd-stand-hidden').show();
                    $('#wd-task-detail-Expect' + i).css('color', 'inherit');
                    $('#wd_task_detail_name' + i).css('color', 'inherit');
                    $('.details_tttt').show();
                }
                function wd_stand_delect(id, i) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/delete/" + id,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {

                                    $('.wd-stand-task-name' + i).css('text-decoration', 'line-through red')
                                    $('#pause' + i + ' img').css('-webkit-filter', 'grayscale(100%)')
                                    $('#wd-stand-alltask' + i).css('animation', 'fade 600ms infinite')
                                    $('#wd-stand-alltask' + i).css('pointer-events', 'none')
                                    $('#Modity' + i).hide();
                                    setTimeout(function () {
                                        $('#wd-stand-alltask' + i).css('animation', '')
                                    }, 1000)
                                    layer.msg(data.msg)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }


                function wd_sub_task_add(i, beacon_id) {
                    //添加子任务下文本框不能为空格
                    let inppt = $('#wd-stand-sub-content' + i).val();
                    if ($.trim(inppt) == "") {
                        layer.msg('输入名称不能为空')
                        return false;
                    }
                    $.ajax({
                        url: "/task/sub_add",
                        async: false,
                        type: "post",
                        data: $('#wd-stand-sub-add' + i).serialize(),
                        success: function (data, result, state) {
                            if (data.state == 0) {
                                layer.msg(data.msg)
                            }
                            else if (data.state == 1) {
                                // $('.wd-stand-task').html('')
                                // task_beacon()
                                let dataid = data.data.tsgid;
                                wd_sub_task_oneadd(dataid, i, beacon_id)
                                layer.msg(data.msg)
                                bianhuastand(i)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function wd_sub_task_oneadd(dataid, i, beacon_id) {
                    let subcont = $('#wd-stand-sub-content' + i).val();
                    let subtime = $('#wd-stand-sub-append' + i).val();

                    let details_subcont = $('#wd-details-sub-content' + i).val();
                    let details_subtime = $('#wd-details-sub-append' + i).val();
                    let sub = '<form id="wd-stand-sub-Modifty' + i + dataid + '" onsubmit="return false" method="post" style="float:left;">' +
                        '<div id="wd-stand-sub-tmp' + i + dataid + '" class="wd-stand-sub">' +
                        '<div class="wd-stand-list">' +
                        '<input type="hidden"  name="id" value="' + dataid + '">' +
                        // <!-- 子任务界面 -->
                        '<div id="wd-stand-sub-ppbb-tmp' + i + dataid + '"  style="display:none;float: left;">' +
                        '<div id="wd-stand-sub-pbdiv-tmp' + i + dataid + '" class="wd-stand-sub-pbdiv-tmp' + i + '" style="float: left;position: absolute;margin-left: -30px;">' +
                        '<div style="display: inline;float: left;">' +
                        '<img src="/img/box.png" alt="" onclick="details_sub_delete_tmp(\'' + dataid + "','" + i + '\')">' +
                        '</div>' +
                        '<div id="wd-stand-tmp-pen' + i + dataid + '" style="display: inline;margin-left: 10px;">' +
                        '<img id="wd-stand-pen' + dataid + '" src="/img/pen.png" alt="" onclick="wd_stand_ppp_tmp(\'' + i + "','" + dataid + '\')">' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        // <!-- 暂停 -->
                        '<div class="wd-stand-sub-line" style="display: inline;margin-left: 15px;">' +
                        '<div style="display: inline;float: left;margin-left: 15px;">' +
                        '<span id="zipause' + i + dataid + '" class="zirenwu" onclick="zipause(\'' + dataid + "','" + i + "','" + dataid + '\');">' +
                        '<img src="/img/blue_begin.png" title ="暂停中" value="1">' +
                        '</span>' +
                        '</div>' +
                        '<div class="wd-stand-sub-checkbox" style="display: inline;margin-left: 8px;float: left;">' +
                        '<span class="complete" id="cboxid' + i + dataid + '" onclick="zirenwu(\'' + i + "','" + dataid + "','" + dataid + '\')">' +
                        '<img src="/img/uncheck.png" style="width: 17px;" title="未完成" value="0">' +
                        '</span>' +
                        '</div>' +
                        // <!-- 子任务名字 -->
                        '<div class="wd-stand-sub-warp">' +
                        '<div id="wd-stand-sub-Content' + i + dataid + '" style="margin-left: 6px;">' +
                        '<span id="wd-Content-sub_span' + i + dataid + '" style="font-size: 12px;"></span>' +
                        '<input id="wd-stand-sub-Content-input' + i + dataid + '" type="text" style="display:none;border: 0;border-bottom: 1px dashed;"name="content" value="">' +
                        '</div>' +
                        '<div id="wd-stand-sub-Expect' + i + dataid + '" style="margin-left: 5px;font-size: 12px;line-height: 1.7;">' +
                        '<span id="wd-Expect-sub_span' + i + dataid + '"></span>' +
                        '<input id="wd-stand-sub-Expect-input' + i + dataid + '" name="expect_end_time" type="text"  style="width: 73px;display:none;border: 0;border-bottom: 1px dashed;" value="">' +
                        '</div>' +
                        '<div id="wd-stand-sub-add' + i + dataid + '" style="display:none;" onclick="wd_sub_task_Modifty(\'' + i + "','" + dataid + '\')">' +
                        '<label style="font-size: 13px;margin-left: 10px;cursor: pointer;">保存</label>' +
                        '</div>' +

                        '<div id="wd-stand-sub-chexiao' + dataid + '" style="display:none;">' +
                        '<label style="font-size: 13px;margin-left: 10px;cursor: pointer;">撤销</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</form>'
                    $('#wd_stand_suballtask' + i).append(sub)
                    $('#wd-stand-sub-Modifty' + i + dataid).fadeOut().fadeIn();

                    let sub_Check_result = '';
                    let sub_Performance_id = '';
                    let sub_State = 1;



                    wd_stand_detail_sub(dataid, details_subtime, details_subtime, details_subcont, sub_Check_result, sub_Performance_id, sub_State, dataid, i)
                    var pau = '<img src="/img/blue_begin.png" title ="暂停中" value="1">'
                    var subbox = '<img style="width: 17px;"  src="/img/uncheck.png" title="未完成" value="0">'
                    $('#zipause' + i + dataid).html(pau)
                    $('#details_zipause' + i + dataid).html(pau)
                    $('#cboxid' + i + dataid).html(subbox)
                    $('#details_cboxid' + i + dataid).html(subbox)

                    wd_sub_task_twoadd(i, dataid, subcont, subtime, details_subcont, details_subtime)
                    sub_onmouse_tmp(i, dataid)
                }
                function sub_onmouse_tmp(i, dataid) {
                    $('#wd-stand-sub-tmp' + i + dataid).mouseover(function () {
                        $('#wd-stand-sub-ppbb-tmp' + i + dataid).show();
                    })
                    $('#wd-stand-sub-tmp' + i + dataid).mouseleave(function () {
                        $('#wd-stand-sub-ppbb-tmp' + i + dataid).hide();
                    })

                    $('#sub_details_all-tmp' + i + dataid).mouseover(function () {
                        $('#wd-details-sub-ppbb-tmp' + i + dataid).show();
                    })
                    $('#sub_details_all-tmp' + i + dataid).mouseleave(function () {
                        $('#wd-details-sub-ppbb-tmp' + i + dataid).hide();
                    })
                }
                // 添加子任务222
                function wd_sub_task_twoadd(i, dataid, subcont, subtime, details_subcont, details_subtime) {
                    // 项目下字任务
                    wd_task_content(i, dataid, subcont, subtime, details_subcont, details_subtime)
                }
                function wd_task_content(i, dataid, subcont, subtime, details_subcont, details_subtime) {

                    // 详情页面下子任务
                    if (subcont != '' || subtime != '') {
                        $('#details-wd-Content-sub_span' + i + dataid).html(subcont)
                        $('#details-wd-ecpect-sub_span' + i + dataid).html(subtime)
                        $('#wd-Content-sub_span' + i + dataid).html(subcont)
                        $('#wd-Expect-sub_span' + i + dataid).html(subtime)
                    }
                    else if (details_subcont != '' || details_subtime != '') {
                        $('#details-wd-Content-sub_span' + i + dataid).html(details_subcont)
                        $('#details-wd-ecpect-sub_span' + i + dataid).html(details_subtime)

                        $('#wd-Content-sub_span' + i + dataid).html(details_subcont)
                        $('#wd-Expect-sub_span' + i + dataid).html(details_subtime)
                    }

                    $('#wd-stand-sub-content' + i).val('')
                    $('#wd-stand-sub-append' + i).val('')

                    $('#wd-details-sub-content' + i).val('')
                    $('#wd-details-sub-append' + i).val('')
                    sub_taskMotify_tmp(dataid, i)
                    sub_details_taskMotify_tmp(dataid, i)
                }
                function sub_taskMotify_tmp(dataid, i) {
                    sub_chexiao_tmp(i, dataid)
                }
                function wd_stand_ppp_tmp(i, dataid) {
                    let sub_content_span = $('#wd-Content-sub_span' + i + dataid).text()
                    let Expect = $('#wd-Expect-sub_span' + i + dataid).text()
                    $('#wd-stand-sub-Content-input' + i + dataid).fadeIn();
                    $('#wd-stand-sub-Expect-input' + i + dataid).fadeIn();
                    $('#wd-stand-sub-Content-input' + i + dataid).val(sub_content_span)
                    $('#wd-stand-sub-Expect-input' + i + dataid).val(Expect)

                    $('#wd-Content-sub_span' + i + dataid).hide();
                    $('#wd-Expect-sub_span' + i + dataid).hide();

                    $('#wd-stand-sub-add' + i + dataid).fadeIn();
                    $('#wd-stand-sub-chexiao' + dataid).fadeIn();
                    $('#wd-stand-tmp-pen' + i + dataid).html('<img onclick="wd_stand_ddd_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                    laytimetmp(i, dataid)
                }
                function wd_stand_ddd_tmp(i, dataid) {
                    $('#wd-stand-sub-Content-input' + i + dataid).hide();
                    $('#wd-stand-sub-Expect-input' + i + dataid).hide();
                    $('#wd-Content-sub_span' + i + dataid).fadeIn();
                    $('#wd-Expect-sub_span' + i + dataid).fadeIn();

                    $('#wd-stand-sub-add' + i + dataid).hide();
                    $('#wd-stand-sub-chexiao' + dataid).hide();

                    $('#wd-stand-tmp-pen' + i + dataid).html('<img onclick="wd_stand_ppp_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                }

                // 详细页面下子任务添加修改
                function sub_details_taskMotify_tmp(dataid, i) {
                    sub_chexiao_tmp(i, dataid)
                }
                function details_sub_pen_tmp(i, dataid) {
                    let sub_content_span = $('#details-wd-Content-sub_span' + i + dataid).text()
                    let Expect = $('#details-wd-ecpect-sub_span' + i + dataid).text()
                    $('#details-wd-stand-sub-Content-input' + i + dataid).fadeIn();
                    $('#details-wd-stand-sub-ecpect-input' + i + dataid).fadeIn();
                    $('#details-wd-stand-sub-Content-input' + i + dataid).val(sub_content_span)
                    $('#details-wd-stand-sub-ecpect-input' + i + dataid).val(Expect)

                    $('#details-wd-Content-sub_span' + i + dataid).hide();
                    $('#details-wd-ecpect-sub_span' + i + dataid).hide();

                    $('#wd-details-stand-sub-add' + i + dataid).fadeIn();
                    $('#wd-details-stand-sub-chexiao' + dataid).fadeIn();

                    $('#wd-details-sub-pen' + dataid).html('<img onclick="wd_details_ddd_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                    laytimetmp(i, dataid)
                }
                function wd_details_ddd_tmp(i, dataid) {
                    $('#details-wd-stand-sub-Content-input' + i + dataid).hide();
                    $('#details-wd-stand-sub-ecpect-input' + i + dataid).hide();
                    $('#details-wd-Content-sub_span' + i + dataid).fadeIn();
                    $('#details-wd-ecpect-sub_span' + i + dataid).fadeIn();

                    $('#wd-details-stand-sub-add' + i + dataid).hide();
                    $('#wd-details-stand-sub-chexiao' + dataid).hide();

                    $('#wd-details-sub-pen' + dataid).html('<img onclick="details_sub_pen_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                }
                function sub_chexiao_tmp(i, dataid) {
                    $('#wd-stand-sub-chexiao' + dataid).click(function () {
                        $('#wd-stand-sub-Content-input' + i + dataid).hide();
                        $('#wd-stand-sub-Expect-input' + i + dataid).hide();
                        $('#wd-Content-sub_span' + i + dataid).fadeIn();
                        $('#wd-Expect-sub_span' + i + dataid).fadeIn();

                        $('#wd-stand-sub-add' + i + dataid).hide();
                        $('#wd-stand-sub-chexiao' + dataid).hide();
                        $('#wd-stand-tmp-pen' + i + dataid).html('<img onclick="wd_stand_ppp_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                    })
                    $('#wd-details-stand-sub-chexiao' + dataid).click(function () {
                        $('#details-wd-stand-sub-Content-input' + i + dataid).hide();
                        $('#details-wd-stand-sub-ecpect-input' + i + dataid).hide();
                        $('#details-wd-Content-sub_span' + i + dataid).fadeIn();
                        $('#details-wd-ecpect-sub_span' + i + dataid).fadeIn();

                        $('#wd-details-stand-sub-add' + i + dataid).hide();
                        $('#wd-details-stand-sub-chexiao' + dataid).hide();
                        $('#wd-details-sub-pen' + dataid).html('<img onclick="details_sub_pen_tmp(\'' + i + "','" + dataid + '\')" src="/img/pen.png" alt="">')
                    })
                }
                function laytimetmp(i, dataid) {
                    laydate.render({
                        elem: '#wd-stand-sub-Expect-input' + i + dataid
                    });
                    laydate.render({
                        elem: '#details-wd-stand-sub-ecpect-input' + i + dataid
                    });

                }
                function wd_sub_task_Modifty(i, s) {
                    $.ajax({
                        url: "/task/sub_edit",
                        async: false,
                        type: "post",
                        data: $('#wd-stand-sub-Modifty' + i + s).serialize(),
                        success: function (data, result, state) {
                            if (data.state == 0) {
                                layer.msg(data.msg)
                            }
                            else if (data.state == 1) {
                                sub_baocun(i, s)
                                layer.msg(data.msg)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function wd_details_sub_task_Modifty_tmp(i, s) {
                    $.ajax({
                        url: "/task/sub_edit",
                        async: false,
                        type: "post",
                        data: $('#wd-details-sub-edit-tmp' + i + s).serialize(),
                        success: function (data, result, state) {
                            if (data.state == 0) {
                                layer.msg(data.msg)
                            }
                            else if (data.state == 1) {
                                sub_details_baocun_tmp(i, s)
                                layer.msg(data.msg)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function sub_baocun(i, s) {
                    let content_input = $('#wd-stand-sub-Content-input' + i + s).val()
                    let expect_input = $('#wd-stand-sub-Expect-input' + i + s).val()
                    $('#wd-Content-sub_span' + i + s).html(content_input)
                    $('#wd-Expect-sub_span' + i + s).html(expect_input)

                    $('#details-wd-Content-sub_span' + i + s).html(content_input)
                    $('#details-wd-ecpect-sub_span' + i + s).html(expect_input)

                    $('#wd-detiails-sub-content-span' + i + s).html(content_input)
                    $('#wd-detiails-sub-time-span' + i + s).html(expect_input)

                    $('#wd-stand-sub-Content-input' + i + s).hide();
                    $('#wd-stand-sub-Expect-input' + i + s).hide();
                    $('#wd-stand-sub-add' + i + s).hide();
                    $('#wd-stand-sub-chexiao' + s).hide();
                    $('#wd-Content-sub_span' + i + s).fadeIn();
                    $('#wd-Expect-sub_span' + i + s).fadeIn();

                    $('#wd-stand-sub-chexiao' + i + s).hide();
                    // 保存
                    wd_stand_ddd(i, s)
                    wd_stand_ddd_tmp(i, s)
                }
                // 详情页下的修改子任务
                function sub_details_baocun_tmp(i, s) {
                    let content_input = $('#details-wd-stand-sub-Content-input' + i + s).val()
                    let expect_input = $('#details-wd-stand-sub-ecpect-input' + i + s).val()
                    $('#details-wd-Content-sub_span' + i + s).html(content_input)
                    $('#details-wd-ecpect-sub_span' + i + s).html(expect_input)
                    $('#details-wd-stand-sub-Content-input' + i + s).hide();
                    $('#details-wd-stand-sub-ecpect-input' + i + s).hide();
                    $('#wd-details-stand-sub-add' + i + s).hide();
                    $('#wd-details-stand-sub-chexiao' + s).hide();

                    $('#details-wd-Content-sub_span' + i + s).fadeIn();
                    $('#details-wd-ecpect-sub_span' + i + s).fadeIn();

                    wd_details_ddd_tmp(i, s)
                }
                // 详细页面下的子任务修改
                function wd_details_sub_task_Modifty(i, s) {
                    $.ajax({
                        url: "/task/sub_edit",
                        async: false,
                        type: "post",
                        data: $('#wd-details-sub-edit' + i + s).serialize(),
                        success: function (data, result, state) {
                            if (data.state == 0) {
                                layer.msg(data.msg)
                            }
                            else if (data.state == 1) {
                                sub_details_baocun(i, s)
                                layer.msg(data.msg)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function sub_details_baocun(i, s) {
                    let content_input = $('#wd-details-sub-contentnoew' + i + s).val()
                    let expect_input = $('#wd-details-sub-time-input' + i + s).val()

                    $('#wd-detiails-sub-content-span' + i + s).html(content_input)
                    $('#wd-detiails-sub-time-span' + i + s).html(expect_input)
                    $('#wd-details-sub-contentnoew' + i + s).hide();
                    $('#wd-details-sub-time-input' + i + s).hide();
                    $('#wd-details-stand-sub-add' + i + s).hide();
                    $('#wd-details-stand-sub-chexiao' + i + s).hide();

                    $('#wd-detiails-sub-content-span' + i + s).fadeIn();
                    $('#wd-detiails-sub-time-span' + i + s).fadeIn();
                }
                // 子任务的删除
                function wd_stnad_sub_delect(sub_id, i, s) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/sub_delete/" + sub_id,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    // $('#wd-stand-sub-Modifty' + i + s).remove();
                                    // $('#wd-details-sub-edit' + i + s).remove();
                                    layer.msg(data.msg)
                                    stand_sub_delete(i, s)

                                    // 如果删除之后，子任务没有可完成的，则任务自动为完成

                                    stand_details_fun(i, s)
                                    bianhuastand(i)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }
                function stand_sub_delete(i, s) {
                    $('#wd-Content-sub_span' + i + s).css('text-decoration', 'line-through red')
                    $('#zipause' + i + s + ' img').css('-webkit-filter', 'grayscale(100%)')
                    $('#wd-stand-sub-Modifty' + i + s).css('animation', 'fade 600ms infinite')
                    $('#wd-stand-sub-Modifty' + i + s).css('pointer-events', 'none')

                    $('#cboxid' + i + s).html('<img style="width: 17px;" src="/img/uncheck.png" title="未完成">');
                    $('#details_cboxid' + i + s).html('<img style="width: 17px;" src="/img/uncheck.png" title="未完成">');


                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" style="-webkit-filter:grayscale(100%)"  title="已删除">')
                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" style="-webkit-filter:grayscale(100%)"  title="已删除">')

                    wd_stand_ddd(i, s)
                    setTimeout(function () {
                        $('#wd-stand-sub-Modifty' + i + s).css('animation', '')
                    }, 1000)

                    $('#wd-detiails-sub-content-span' + i + s).css('text-decoration', 'line-through red')
                    $('#details_zipause' + i + s + ' img').css('-webkit-filter', 'grayscale(100%)')
                    $('#wd-details-sub-edit' + i + s).css('animation', 'fade 600ms infinite')
                    $('#wd-details-sub-edit' + i + s).css('pointer-events', 'none')
                    details_sub_den(i, s)
                    setTimeout(function () {
                        $('#wd-details-sub-edit' + i + s).css('animation', '')
                    }, 1000)
                }
                // 详细页面下子任务的删除
                function details_sub_delete(sub_id, i, s) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/sub_delete/" + sub_id,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    $('#wd-stand-sub-Modifty' + i + s).remove();
                                    // $('#sub_details_all' + i + s).remove();
                                    $('#wd-details-sub-edit' + i + s).remove();
                                    layer.msg(data.msg)
                                    // $('.wd-stand-task').html('')
                                    // task_beacon()
                                    bianhuastand(i)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }

                // 临时页面下子任务的添加
                function wd_details_sub_task_add(i, beacon_id) {
                    let inppt = $('#wd-details-sub-content' + i).val();
                    if ($.trim(inppt) == "") {
                        layer.msg('输入名称不能为空')
                        return false;
                    }
                    $.ajax({
                        url: "/task/sub_add",
                        async: false,
                        type: "post",
                        data: $('#wd-details-sub-add' + i).serialize(),
                        success: function (data, result, state) {
                            if (data.state == 0) {
                                layer.msg(data.msg)
                            }
                            else if (data.state == 1) {

                                let dataid = data.data.tsgid;
                                wd_sub_task_oneadd(dataid, i, beacon_id)
                                layer.msg(data.msg)
                                bianhuastand(i)
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                // 临时详细下子任务删除
                function details_sub_delete_tmp(dataid, i) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/sub_delete/" + dataid,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    details_ddd_tmp(i, dataid)
                                    layer.msg(data.msg)
                                    stand_details_fun(i, dataid)

                                    bianhuastand(i)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }
                function details_ddd_tmp(i, dataid) {
                    $('#wd-Content-sub_span' + i + dataid).css('text-decoration', 'line-through red')
                    $('#zipause' + i + dataid + ' img').css('-webkit-filter', 'grayscale(100%)')
                    $('#wd-stand-sub-Modifty' + i + dataid).css('animation', 'fade 600ms infinite')
                    $('#wd-stand-sub-Modifty' + i + dataid).css('pointer-events', 'none')
                    wd_details_ddd_tmp(i, dataid)
                    wd_stand_ddd_tmp(i, dataid)
                    setTimeout(function () {
                        $('#wd-stand-sub-Modifty' + i + dataid).css('animation', '')
                    }, 1000)
                    // 临时删除后，去掉img里面的value
                    $('#cboxid' + i + dataid).html('<img style="width: 17px;" src="/img/uncheck.png" title="未完成">');
                    $('#details_cboxid' + i + dataid).html('<img style="width: 17px;" src="/img/uncheck.png" title="未完成">');
                    $('#zipause' + i + dataid).html('<img src="/img/blue_begin.png" style="-webkit-filter:grayscale(100%)" title="已删除">')
                    $('#details_zipause' + i + dataid).html('<img src="/img/blue_begin.png" style="-webkit-filter:grayscale(100%)" title="已删除">')
                    // 特效以及不可点击
                    $('#wd-details-sub-edit-tmp' + i + dataid).css('pointer-events', 'none')
                    $('#details_zipause' + i + dataid + ' img').css('-webkit-filter', 'grayscale(100%)')
                    $('#details-wd-Content-sub_span' + i + dataid).css('text-decoration', 'line-through red')
                    $('#wd-details-sub-edit-tmp' + i + dataid).css('animation', 'fade 600ms infinite')
                    wd_details_ddd_tmp(i, dataid)
                    setTimeout(function () {
                        $('#wd-details-sub-edit-tmp' + i + dataid).css('animation', '')
                    }, 1000)
                }
                function detail_send_stands(i, beacon_id) {

                    let input = $('#wd-stand-commit-textare' + i).val();
                    if ($.trim(input) == "") {
                        layer.msg('任务评论内容不能为空。')
                        return false;
                    }
                    let talkdata = [];
                    let content = [];
                    let str = $('#wd_stand_detail_comomit' + i).serialize()
                    let arr = str.split('&');

                    for (d = 0; d < arr.length; d++) {
                        let tmp = arr[d].split('=');
                        if (tmp[0] == 'content') {
                            content.push(tmp[1])
                        } else {
                            talkdata.push(arr[d])
                        }
                    }

                    talkdata.push("content=" + content)
                    talkdata = talkdata.join('&')
                    let cont = talkdata.replace(/,/g, "=$>")
                    // let cont=  talkdata.replace(',','=$>')
                    $.ajax({
                        url: "/task/comment_add",
                        async: false,
                        type: "post",
                        data: cont,
                        success: function (result, testStatus, data) {
                            if (result.state == 0) {
                                layer.msg(result.msg)
                            } else if (result.state == 1) {
                                datacomment(i, data, beacon_id, cont)
                                // wd-details-commits8


                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function datacomment(i, data, beacon_id, cont) {
                    let arrping = [];
                    let tmp = cont.split('&');
                    for (d = 0; d < tmp.length; d++) {
                        let objping = tmp[d].split('=');
                        if (objping[0] == 'content') {
                            for (h = 0; h < objping.length; h++) {
                                if (objping[h] != 'content') {
                                    arrping.push(objping[h])
                                }
                            }
                        }
                    }
                    let k = data.responseJSON.data.cmtid;
                    var myDate = new Date();
                    var myMonth = myDate.getMonth() + 1; // 获取当前月份
                    var myDay = myDate.getDate() // 获取当前日（1- 31）
                    var myHours = myDate.getHours() // 获取当前小时(0-23)
                    var myMinu = myDate.getMinutes() // 获取当前分钟(0-59)
                    var times = myMonth + '-' + myDay + ' ' + myHours + ':' + myMinu;
                    var text = $('#wd-stand-commit-textare' + i).val();
                    var aee = JSON.parse(localStorage.getItem('userLogin'));
                    var ugid = aee.ugid;
                    let na = decodeURIComponent(aee.name);
                    let nname = na.replace(/\+/g, '')
                    var result = nname.replace(/(^\s+)|(\s+$)/g, "");//去掉前后空格
                    let textcomment = text
                    // $('.wd-new-reportman-people').html(result);
                    details_commadd(i, k, times, textcomment, ugid, result, beacon_id, arrping)
                    $('#wd-stand-commit-textare' + i).val('')
                }
                function details_commadd(i, k, times, textcomment, ugid, result, beacon_id, arrping) {
                    let textnew = textcomment.replace(/\@/g, '')
                    // console.log(textcomment)
                    $('#wd-details-commits' + i).prepend('<div id="ping_talk_divdiv' + i + k + '" class="ping_talk_div' + i + k + '"><div class="ping_div" id="ping_div' + k + '">' +
                        '<input type="hidden" value="' + ugid + '">' + '<a style="font-size: 13px;color:black;">' + '刚刚' + ' ' + '</a>' +
                        '<a class="pinglun_time" style="font-size: 13px;color: rgb(85, 85, 85);margin-left: 2px;">' + '<span class="pinglun_dat' + i + k + '">' + result + '</span>' +
                        '<span style="margin-left: 8px;color: black;font-weight: bold;">' + '评论：' + '</span>' +
                        //修改删除等...........
                        '<a class="ping_xiugaidiv' + i + k + '" id="ping_xiugai"><div>' +
                        '<img src="/img/Task/toptoptop.png" title="引用" style="width: 12px;height: 12px;margin-right: 25px;opacity: 0.7;" onclick="detialstoptop(\'' + i + "','" + k + '\')">' +
                        '<img id="ping_pendiv' + i + k + '" class="ping_pen" src="/img/pen.png">' +
                        '<img class="ping_box" onclick="comment_delect(\'' + i + "','" + k + "','" + k + '\')" src="/img/box.png">' + '</div></a>' +
                        //修改删除等...........
                        '<div class="ping_aitteme" id="ping_aiteme_cont' + i + k + '" style="border-radius: 5px;width: 75%;margin: 0 auto;padding-top: 5px;padding-bottom: 5px;"></div>' +
                        '<div class="ping_ctn" style="font-size: 14px;margin: 0px auto;width: 69%;white-space: pre-line;" id="ping_content' + i + k + '">' + ' ' + decodeURIComponent(textnew) + '</div>' +
                        '<form id="edit_form' + i + k + '"class="" onsubmit="return false" method="post">' +
                        '<a class="edit_div_input' + i + k + '"></a>' +
                        '<div id="ping_edit' + i + k + '" class="ping_edit"><input id="ping_hidden' + k + '" type="hidden" name="id" value="' +
                        decodeURIComponent(k) + '" /><textarea name="content" style="font-size: 14px;" id="wd-stand-ping-textarea' + i + k + '" class="ping_text"></textarea>' +
                        '<input type="hidden" value="" name="content" id="wd-stand-ping-iinpu' + i + k + '">' +
                        '<p><input type="submit" value="保存" onclick="comment_edit(\'' + k + "','" + beacon_id + "','" + i + '\')" />' +
                        '<input id="ping_resetdiv' + i + k + '" class="ping_reset" type="submit" value="取消"  /></p>' +
                        '</div>' +
                        '</form>' +
                        '</div>' +
                        '</div>')
                    str = '';
                    html = '';
                    arrping.reverse() //倒序
                    for (h = 0; h < arrping.length; h++) {
                        let textne = decodeURIComponent(arrping[h]).replace('$>', '')
                        let textnne = textne.replace(/\+/g, ' ')
                        if (textnne != '') {
                            if (textnne.indexOf('@') > -1) {
                                if (textnne != undefined) {
                                    let wid = h / 10;
                                    let tt = 95 - wid + '%'
                                    // $('#ping_aiteme_cont' + i + k).append('<div class="ping_aite_cont' + i + k + '" style="border-radius: 5px;width:'+tt+';min-width: 30%;padding-left: 113px;text-indent: -56.5px;border: 1px solid;font-size: 11px;color: #999999;margin: 0 auto;">'+textnne+'</div>')
                                    html += '<div id="ping-aite-cont" class="ping_aite_cont' + i + k + '" style="min-width: 30%;margin: 0 auto;margin-top: 5px;margin-bottom: 5px;width: ' + tt + ';font-size: 11px;color: #999999;">' + textnne
                                    str += '</div>'
                                }
                            } else {
                                $('#ping_content' + i + k).html(textnne)
                            }
                        }
                    }
                    html += str
                    $('#ping_aiteme_cont' + i + k).html(html);
                    $('.ping_aite_cont' + i + k).each(function () {
                        $(this).children('div').prependTo($(this))
                    })

                    $('.wd_ping_aite').html('')
                    $('#ping_aite_remove' + i).hide()
                    // $('#ping_aite_remove'+i).hide();

                    wd_details_comment_show_add(i, k)
                }
                // 评论修改
                function comment_edit(k, beacon_id, i) {
                    let input = $('#wd-stand-ping-textarea' + i + k).val();

                    if ($.trim(input) == "") {
                        layer.msg('任务评论内容不能为空。')
                        return false;
                    }
                    let talkdata = [];
                    let content = [];
                    let str = $('#edit_form' + i + k).serialize()
                    let arr = str.split('&');

                    for (d = 0; d < arr.length; d++) {
                        let tmp = arr[d].split('=');
                        if (tmp[0] == 'content') {
                            content.push(tmp[1])
                        } else {
                            talkdata.push(arr[d])
                        }
                    }

                    talkdata.push("content=" + content)
                    talkdata = talkdata.join('&')
                    let cont = talkdata.replace(/,/g, "=$>")
                    // console.log(talkdata)
                    $.ajax({
                        url: "/task/comment_edit",
                        async: false,
                        type: "post",
                        data: cont,
                        success: function (result, testStatus, data, msg) {
                            if (result.state == 0) {
                                layer.msg(result.msg)
                            }
                            else if (result.state == 1) {
                                comment_edit_Mo(i, k)
                                layer.msg(result.msg)
                                $('.wd_ping_aite').html('')
                                $('#ping_aite_remove' + i).hide()
                            }
                        },
                        error: function (xhr, errorMessage, e) {
                            alert("系统异常");
                        }
                    })
                }
                function comment_edit_Mo(i, k) {
                    let moinput = $('.ping_aite_cont' + i + k).text();
                    let contt = moinput.split('@');

                    let texttmp = $('#wd-stand-ping-textarea' + i + k).val();
                    let ttext = texttmp.replace(/\@/g, '')
                    $('#ping_content' + i + k).html(ttext)
                    $('#ping_edit' + i + k).hide();
                    $('#ping_content' + i + k).fadeIn();
                }
                // 删除评论
                function comment_delect(i, k, number_id) {
                    layer.confirm('您真的确定要删除吗？\n\n请确认！', {
                        btn: ['是的', '放弃'] //按钮
                    }, function () {
                        $.ajax({
                            url: "/task/comment_delete/" + number_id,
                            async: false,
                            type: "GET",
                            success: function (data, result, msg, testStatus, state) {
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                } else if (data.state == 1) {
                                    $('#ping_talk_div' + i + k).remove();
                                    $('#ping_talk_divdiv' + i + k).remove();
                                    layer.msg(data.msg)
                                }
                            },
                            error: function (xhr, errorMessage, e) {
                                alert("系统异常");
                            }
                        })
                    }, function () {
                    });
                }
                function wd_stand_details_clsoe(i) {
                    $('body').css('overflow','auto')
                    var stateObj = { foo: 'bar' };
                    history.pushState(stateObj, null, '{{.project_gid}}');
                    // window.history.back();
                    $('.details_tttt').show();
                    $('#wd-stand-details' + i).hide();
                    $('.detail_member').fadeIn();
                    $('.wd-stand-qingdan').fadeIn();

                    $('#wd-task-detail-Expect' + i).css('color', 'inherit');
                    $('#wd_task_detail_name' + i).css('color', 'inherit');
                    $('#wd_stand_finish').show();
                    $('#wd_beacon_task_finish').show();

                    $('.wd-stand-hidden').fadeIn();
                    $('#screening_tag').html('')
                    $('.wd_stand_style').hide();
                    let add = $('#wd_details_opt_tag').val('-1')
                    add.attr('selected', true)
                    $('.wd_stand_alltask').show();
                }
                $(document).ready(function () {
                    $('.detail_href').click(function () {
                        $('.wd-stand-qingdan').html('')

                        // $('.wd-stand-task').html('')
                        $('.wd-body-stand-details').html('')
                        $('.wd-stand-qingdan').fadeIn();
                        // $('.wd-stand-Modify').html('')
                        $('.wd-stand-hidden').html('')
                        
                        $('#c_sc_t_class').html('')
                        $('#c_sc_t_task').html('')
                        $('#c_sc_t_tag').html('')
                        task_beacon()
                    })
                })
                // 任务的状态
                function pause(i, beacon_id) {
                    pause_task(i, beacon_id)
                }
                // 任务的状态
                function details_pause(i, beacon_id) {
                    pause_details_task(i, beacon_id)
                }

                function allppox(i) {
                    $('#pause' + i).css('pointer-events', 'none');
                    $('#details_pause' + i).css('pointer-events', 'none');
                }
                function allppox_xing(i) {
                    $('#pause' + i).css('pointer-events', '');
                    $('#details_pause' + i).css('pointer-events', '');
                }
                function allsubppox(i, s) {
                    $('#zipause' + i + s).css('pointer-events', 'none');
                    $('#details_zipause' + i + s).css('pointer-events', 'none');
                }
                function allsubppox_xing(i, s) {
                    $('#zipause' + i + s).css('pointer-events', '');
                    $('#details_zipause' + i + s).css('pointer-events', '');
                }
                function pause_task(i, beacon_id) {
                    let pauses = $('#pause' + i + ' img').attr("value");
                    if (pauses == 0) {
                        setTimeout(function () {
                            $('#pause' + i).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allppox(i)
                        });
                        setTimeout(function () {
                            Task_Pause(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allppox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    // let arr = $('#todolist'+k+' .zirenwu img');
                                    let arr = $('#wd-stand-suball' + i + ' .zirenwu');
                                    for (let j = 0; j < arr.length; j++) {
                                        let fff = arr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');

                                        if (yy == 0) {
                                            $('#' + fff).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        }
                                    }
                                    let detailsarr = $('#wd-task-details-suball' + i + ' .zirenwu');
                                    for (let j = 0; j < detailsarr.length; j++) {
                                        let fff = detailsarr[j].getAttribute('id');

                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            $('#' + fff).html('<img style="width:12px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        }
                                    }
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                            })
                        }, 700);
                    } else {
                        setTimeout(function () {
                            $('#pause' + i).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allppox(i)
                        });
                        setTimeout(function () {
                            Task_Start(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allppox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                }
                            })
                        }, 700);
                        // task_start(Task_id)
                        // $('#pause'+k).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                    }
                }
                // 任务详情
                function pause_details_task(i, beacon_id) {
                    let details_pauses = $('#details_pause' + i + ' img').attr("value");
                    if (details_pauses == 0) {
                        setTimeout(function () {
                            $('#details_pause' + i).html('<img style="width:15px;" src="/img/loadinga.gif" title ="等待中">');
                            allppox(i)
                        });
                        setTimeout(function () {
                            Task_Pause(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allppox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    // let arr = $('#todolist'+k+' .zirenwu img');
                                    let arr = $('#wd-stand-suball' + i + ' .zirenwu');
                                    for (let j = 0; j < arr.length; j++) {
                                        let fff = arr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');

                                        if (yy == 0) {
                                            $('#' + fff).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        }
                                    }
                                    let detailsarr = $('#wd-task-details-suball' + i + ' .zirenwu');
                                    for (let j = 0; j < detailsarr.length; j++) {
                                        let fff = detailsarr[j].getAttribute('id');

                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            $('#' + fff).html('<img style="width:12px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        }
                                    }
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#details_pause' + k).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                            })
                        }, 700);
                    } else {
                        setTimeout(function () {
                            $('#details_pause' + i).html('<img style="width:15px;" src="/img/loadinga.gif" title ="等待中">');
                            allppox(i)
                        });
                        setTimeout(function () {
                            Task_Start(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allppox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                }
                            })
                        }, 700);
                        // task_start(Task_id)
                        // $('#pause'+k).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                    }
                }
                // 触发子任务开始暂停函数
                function zipause(s, i, sub_id) {

                    // 检查项状态，定义“-1”为不可用，“0”为冻结状态，“1”为正常(未开始或暂停)，“2”为开始状态，“3”为已完成，默认为”1“。
                    // alert(Sub_id);
                    let pauses = $('#zipause' + i + s + ' img').attr("value");
                    if (pauses == 0) {
                        setTimeout(function () {
                            $('#zipause' + i + s).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allsubppox(i, s)
                        });
                        setTimeout(function () {
                            sub_Pause(sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubppox_xing(i, s)
                                // $('#zipause'+k+i).html('<img src="/img/loadinga.gif" title ="等待中">');
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    // 如果返回值为-1，说明所有子任务都暂停了，父任务也暂停
                                    if (zhuzi(i, s) == '-1') {
                                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        // 详细
                                        $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    }
                                    if (data.state == 0) {
                                        layer.msg(data.msg)
                                        $('#zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                        $('#details_zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    }
                                }
                            })
                        }, 700);
                        // 如果等于0说明任务处于开始状态，一下操作是要将它暂停

                    } else {
                        setTimeout(function () {
                            $('#zipause' + i + s).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allsubppox(i, s)
                        });
                        setTimeout(function () {
                            // 说明任务处于暂停状态，将它开始
                            sub_Start(sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubppox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#pause' + i).html('<img src="/img/red_end.png" title ="开始中" value="0">');

                                    $('#details_zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                // 判断子任务是否全部都设置为暂停，如果是，则主任务也暂停
                function zhuzi(i, s) {
                    var rrr = new Array();

                    let arr = $('#wd-stand-alltask' + i + ' .zirenwu img');

                    for (let j = 0; j < arr.length; j++) {

                        rrr.push(arr[j].getAttribute('value'));
                    }

                    let index = rrr.indexOf('0');
                    return index
                }

                // 详细页面下的子任务

                function details_zipause(i, s, sub_id) {

                    // 检查项状态，定义“-1”为不可用，“0”为冻结状态，“1”为正常(未开始或暂停)，“2”为开始状态，“3”为已完成，默认为”1“。
                    // alert(Sub_id);
                    let pauses = $('#details_zipause' + i + s + ' img').attr("value");
                    if (pauses == 0) {
                        setTimeout(function () {
                            $('#details_zipause' + i + s).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allsubppox(i, s)
                        });
                        setTimeout(function () {
                            sub_Pause(sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubppox_xing(i, s)
                                // $('#zipause'+k+i).html('<img src="/img/loadinga.gif" title ="等待中">');
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    // 如果返回值为-1，说明所有子任务都暂停了，父任务也暂停
                                    if (zhuzi(i, s) == '-1') {
                                        $('#pause' + i).html('<img  src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        // 详细
                                        $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    }
                                    if (data.state == 0) {
                                        layer.msg(data.msg)
                                        $('#zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                        $('#details_zipause' + i + s).html('<img  src="/img/red_end.png" title ="开始中" value="0">');
                                    }
                                }
                            })
                        }, 700);
                        // 如果等于0说明任务处于开始状态，一下操作是要将它暂停

                    } else {
                        setTimeout(function () {
                            $('#details_zipause' + i + s).html('<img src="/img/loadinga.gif" title ="等待中">');
                            allsubppox(i, s)
                        });
                        setTimeout(function () {
                            // 说明任务处于暂停状态，将它开始
                            sub_Start(sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubppox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#pause' + i).html('<img src="/img/red_end.png" title ="开始中" value="0">');

                                    $('#details_zipause' + i + s).html('<img src="/img/red_end.png" title ="开始中" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/red_end.png" title ="开始中" value="0">');
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                // 判断子任务是否全部都设置为暂停，如果是，则主任务也暂停
                function details_zhuzi(i, s) {
                    var rrr = new Array();
                    // $('#zipause'+k+i).html('<img src="/img/blue_begin.png" value="1">');
                    let arr = $('#wd-task-details-suball' + i + ' .zirenwu img');
                    for (let j = 0; j < arr.length; j++) {

                        rrr.push(arr[j].getAttribute('value'));
                    }

                    let index = rrr.indexOf('0');
                    return index
                }

                function allbbox(i) {
                    $('#zrw' + i).css('pointer-events', 'none');
                    $('#details_zrw' + i).css('pointer-events', 'none');
                }
                function allbbox_xing(i) {
                    $('#zrw' + i).css('pointer-events', '');
                    $('#details_zrw' + i).css('pointer-events', '');
                }
                function allsubbbox(i, s) {
                    $('#cboxid' + i + s).css('pointer-events', 'none');
                    $('#details_cboxid' + i + s).css('pointer-events', 'none');
                }
                function allsubbbox_xing(i, s) {
                    $('#cboxid' + i + s).css('pointer-events', '');
                    $('#details_cboxid' + i + s).css('pointer-events', '');
                }
                // 触发父任务完成和重新打开
                function boxover(i, beacon_id) {
                    let zrw = $('#zrw' + i + ' img').attr("value");
                    if (zrw == 0) {
                        setTimeout(function () {
                            $('#zrw' + i).html('<img src="/img/loading.gif" title ="等待中">');
                            allbbox(i)
                        });
                        setTimeout(function () {
                            // 当父任务完成时，子任务要全部完成
                            Task_complete(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allbbox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zrw' + i).html('<img  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#pause' + i).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#wd-stand-alltask' + i + ' .zirenwu').css('pointer-events', 'none');
                                    $('#pause' + i).css('pointer-events', 'none');

                                    $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_pause' + i).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#details_wd-stand-alltask' + i + ' .zirenwu').css('pointer-events', 'none');
                                    $('#details_pause' + i).css('pointer-events', 'none');
                                    $('#wd-stand-Modifu' + i).hide();
                                    hhhh(i)
                                    task_returnto(i) //如果点击完成，添加到最下面
                                    // 完成时保存按钮消失
                                    details_use_hide(i)
                                    // let arr = $('#todolist'+k+' .zirenwu img');
                                    let arr = $('#wd-stand-alltask' + i + ' .complete');

                                    for (let j = 0; j < arr.length; j++) {
                                        // 获取子任务下开始暂停图标的span的id
                                        let fff = arr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            let nff = fff.split('cboxid')
                                            $('#' + fff).html('<img style="width: 17px;"  src="/img/checked.png" title="已完成" value="1">');
                                            $('#zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#zipause' + nff[1]).css('pointer-events', 'none');

                                            $('#details_zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#details_zipause' + nff[1]).css('pointer-events', 'none');
                                            $('.wd-stand-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh' + i).hide();
                                            $('.wd-stand-sub-pbdiv-tmp' + i).hide(); //临时项目下任务隐藏

                                        }
                                    }

                                    let dearr = $('#wd-task-details-suball' + i + ' .complete');

                                    for (let j = 0; j < dearr.length; j++) {
                                        // 获取子任务下开始暂停图标的span的id
                                        let fff = dearr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            let nff = fff.split('details_cboxid')
                                            $('#' + fff).html('<img style="width: 17px;"  src="/img/checked.png" title="已完成" value="1">');
                                            $('#zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#zipause' + nff[1]).css('pointer-events', 'none');

                                            $('#details_zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">').css('pointer-events', 'none');
                                            $('#details_zipause' + nff[1]).css('pointer-events', 'none');
                                            $('.wd-stand-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh-tmp' + i).hide();
                                        }
                                    }

                                }
                                let numval = $('#wd-stand-sub_stat' + i).text()
                                let numa = numval.split('/')
                                let fractional = (fs(i)) + '/' + String(numa[1])
                                $('#wd-stand-sub_stat' + i).html(fractional)
                                $('#wd-stand-sub_statclose' + i).html(fractional)

                                $('#wd-details-sub-fins-open' + i).html(fractional)
                                $('#wd-details-sub-fins-close' + i).html(fractional)
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#details_zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                }

                            })
                        }, 700);
                        // Task_complete(Task_id,k)
                    } else {
                        setTimeout(function () {
                            $('#zrw' + i).html('<img style="width: 17px;"  src="/img/loading.gif" title ="等待中">');
                            allbbox(i)
                        });
                        setTimeout(function () {
                            Task_Reopen(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allbbox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="已完成" value="1">');
                                    $('#pause' + i).css('pointer-events', '');

                                    $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="已完成" value="1">');
                                    $('#details_pause' + i).css('pointer-events', '');
                                    // $('.wd-stand-sub-hhhh'+i).show();
                                    $('#wd-stand-Modifu' + i).hide();
                                    ssss(i)
                                    task_appendto(i) //如果成功，则返回
                                    // 完成时保存按钮显示
                                    details_use_show(i)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#zrw' + i).html('<img src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_zrw' + i).html('<img src="/img/checked.png" title ="已完成" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                // 触发子任务完成和重新打开
                function zirenwu(i, s, Sub_id) {
                    let ad = $('#cboxid' + i + s + ' img').attr("value");
                    // let ad = $('#cboxid'+k+i).attr("value");
                    if (ad == 0) {
                        setTimeout(function () {
                            $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/loading.gif" title ="等待中">');
                            allsubbbox(i, s)
                        });
                        setTimeout(function () {
                            sub_Complete(Sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubbbox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#zipause' + i + s).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#zipause' + i + s).css('pointer-events', 'none');
                                    tmp_hhhh(i, s)

                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#details_zipause' + i + s).css('pointer-events', 'none');

                                    details_hhhh(i, s)
                                    $('#wd-details-sub-hhhh' + i + s).hide();
                                    $('#wd-details-sub-hhhh-tmp' + i + s).hide();
                                    task_sub_appendto(i, s)  //子任务完成添加在最后

                                    let numval = $('#wd-stand-sub_stat' + i).text()
                                    let numa = numval.split('/')

                                    // 当一个子任务完成，其他的子任务都是暂停时，父任务也暂停
                                    if (zhuzi(i, s) == -1) {
                                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#pause' + i).css('pointer-events', '');

                                        $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#details_pause' + i).css('pointer-events', '');
                                        // 当子任务是最后一个完成的子任务时，父任务自动完成
                                        if (zirenwuok(i, s) == '-1') {
                                            $('#pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                                            $('#zrw' + i).html('<img  src="/img/checked.png" title ="已完成" value="1">');
                                            $('#pause' + i).css('pointer-events', 'none');

                                            $('#details_pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                                            $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                                            $('#details_pause' + i).css('pointer-events', 'none');
                                            task_returnto(i) //如果点击完成，添加到最下面
                                            hhhh(i)
                                            sub_hhhh(i, s)
                                            details_use_hide(i)
                                            // $('#zrw'+k).css('pointer-events','none');
                                        }
                                    }

                                    let fractional = (fs(i)) + '/' + String(numa[1])
                                    $('#wd-stand-sub_stat' + i).html(fractional)
                                    $('#wd-stand-sub_statclose' + i).html(fractional)
                                    $('#wd-details-sub-fins-open' + i).html(fractional)
                                    $('#wd-details-sub-fins-close' + i).html(fractional)

                                    sub_hhhh(i, s)
                                    tmp_hhhh(i, s)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#cboxid' + i + s).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#details_cboxid' + i + s).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                }
                            })
                        }, 700);
                    } else {
                        setTimeout(function () {
                            $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/loading.gif" title ="等待中">');
                            allsubbbox(i, s)
                        });
                        setTimeout(function () {
                            sub_Reopen(Sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubbbox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    // 子任务重新打开时，改为未选中状态的图标
                                    $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                    // 子任务重新打开时，显示开始暂停按钮
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#zipause' + i + s).css('pointer-events', '');

                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                    // 子任务重新打开时，显示开始暂停按钮
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).css('pointer-events', '');
                                    // task_returnto(i)

                                    task_sub_prependTo(i, s)
                                    let numval = $('#wd-stand-sub_stat' + i).text()
                                    let numa = numval.split('/')

                                    // 子任务重新打开时，父任务重新打开，并且显示父任务的开始暂停按钮
                                    if (zhuzi(i, s) == -1) {
                                        $('#zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#pause' + i).css('pointer-events', '');

                                        $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/uncheck.png" title ="未完成" value="0">');
                                        $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#details_pause' + i).css('pointer-events', '');

                                        $('#wd-stand-sub-hhhh' + i + s).show();
                                        $('#wd-details-sub-hhhh' + i + s).show();
                                        $('#wd-details-sub-hhhh-tmp' + i + s).show();
                                        ssss(i)
                                        details_ssss(i, s)
                                        sub_ssss(i, s)
                                        task_appendto(i)
                                        details_use_show(i)
                                    }
                                    details_ssss(i, s)
                                    sub_ssss(i, s)
                                    tmp_ssss(i, s)
                                    let fractional = (fs(i)) + '/' + String(numa[1])
                                    $('#wd-stand-sub_stat' + i).html(fractional)
                                    $('#wd-stand-sub_statclose' + i).html(fractional)
                                    $('#wd-details-sub-fins-open' + i).html(fractional)
                                    $('#wd-details-sub-fins-close' + i).html(fractional)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#cboxid' + i + s).html('<img src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_cboxid' + i + s).html('<img src="/img/checked.png" title ="已完成" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                function zirenwuok(i, s) {


                    var rrr = new Array();
                    // $('#zipause'+k+i).html('<img src="/img/blue_begin.png" value="1">');
                    let arr = $('#wd-stand-alltask' + i + ' .complete img');

                    for (let j = 0; j < arr.length; j++) {

                        rrr.push(arr[j].getAttribute('value'));
                    }
                    let index = rrr.indexOf('0');
                    return index
                }

                // 详情页面下的任务重新打开完成

                // 触发父任务完成和重新打开
                function details_boxover(i, beacon_id) {
                    let zrw = $('#details_zrw' + i + ' img').attr("value");
                    if (zrw == 0) {
                        setTimeout(function () {
                            $('#details_zrw' + i).html('<img style="width:32px;" src="/img/loading.gif" title ="等待中">');
                            allbbox(i)
                        });
                        setTimeout(function () {
                            // 当父任务完成时，子任务要全部完成
                            Task_complete(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allbbox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#details_zrw' + i).html('<img src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_pause' + i).html('<img  src="/img/kb.png" title ="已完成" value="11">');
                                    $('#wd-task-details-suball' + i + ' .zirenwu').css('pointer-events', 'none');
                                    $('#details_pause' + i).css('pointer-events', 'none');
                                    $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');


                                    $('#zrw' + i).html('<img  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#pause' + i).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#wd-stand-alltask' + i + ' .zirenwu').css('pointer-events', 'none');
                                    $('#pause' + i).css('pointer-events', 'none');
                                    $('.wd-stand-sub-pbdiv-tmp' + i).hide(); //临时项目下任务隐藏

                                    hhhh(i)
                                    task_returnto(i)
                                    // 完成时按钮消失
                                    details_use_hide(i)
                                    // let arr = $('#todolist'+k+' .zirenwu img');
                                    let arr = $('#wd-stand-alltask' + i + ' .complete');

                                    for (let j = 0; j < arr.length; j++) {
                                        // 获取子任务下开始暂停图标的span的id
                                        let fff = arr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            let nff = fff.split('cboxid')
                                            $('#' + fff).html('<img style="width: 17px;"  src="/img/checked.png" title="已完成" value="1">');
                                            $('#zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#zipause' + nff[1]).css('pointer-events', 'none');

                                            $('#details_zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#details_zipause' + nff[1]).css('pointer-events', 'none');
                                            $('.wd-stand-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh' + i).hide();
                                        }
                                    }

                                    let dearr = $('#wd-task-details-suball' + i + ' .complete');

                                    for (let j = 0; j < dearr.length; j++) {
                                        // 获取子任务下开始暂停图标的span的id
                                        let fff = dearr[j].getAttribute('id');
                                        // 获取子任务开始暂停图标的vaue值用以判断是开始还是暂停
                                        let yy = $('#' + fff + ' img').attr('value');
                                        if (yy == 0) {
                                            let nff = fff.split('details_cboxid')
                                            $('#' + fff).html('<img style="width: 17px;"  src="/img/checked.png" title="已完成" value="1">');
                                            $('#zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#zipause' + nff[1]).css('pointer-events', 'none');

                                            $('#details_zipause' + nff[1]).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                            $('#details_zipause' + nff[1]).css('pointer-events', 'none');
                                            $('.wd-stand-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh' + i).hide();
                                            $('.wd-details-sub-hhhh-tmp' + i).hide();
                                        }
                                    }
                                }
                                let numval = $('#wd-details-sub-fins-close' + i).text()
                                let numa = numval.split('/')
                                let fractional = (detailsfs(i)) + '/' + String(numa[1])
                                $('#wd-stand-sub_stat' + i).html(fractional)
                                $('#wd-stand-sub_statclose' + i).html(fractional)

                                $('#wd-details-sub-fins-open' + i).html(fractional)
                                $('#wd-details-sub-fins-close' + i).html(fractional)
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#details_zrw' + i).html('<img style="width: 32px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                }

                            })
                        }, 700);
                        // Task_complete(Task_id,k)
                    } else {
                        setTimeout(function () {
                            $('#details_zrw' + i).html('<img style="width:32px;"  src="/img/loading.gif" title ="等待中">');
                            allbbox(i)
                        });
                        setTimeout(function () {
                            Task_Reopen(beacon_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allbbox_xing(i)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#details_zrw' + i).html('<img style="width: 32px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#details_pause' + i).html('<img style="width:15px;" src="/img/blue_begin.png" title ="已完成" value="1">');
                                    $('#details_pause' + i).css('pointer-events', '');


                                    $('#zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                    $('#pause' + i).html('<img src="/img/blue_begin.png" title ="已完成" value="1">');
                                    $('#pause' + i).css('pointer-events', '');

                                    ssss(i)
                                    task_appendto(i) //如果成功，则返回
                                    // 重新打开按钮显示
                                    details_use_show(i)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                function details_zirenwu(i, s, Sub_id) {
                    let ad = $('#details_cboxid' + i + s + ' img').attr("value");
                    // let ad = $('#cboxid'+k+i).attr("value");
                    if (ad == 0) {
                        setTimeout(function () {
                            $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/loading.gif" title ="等待中">');
                            allsubbbox(i, s)
                        });
                        setTimeout(function () {
                            sub_Complete(Sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubbbox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#zipause' + i + s).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#zipause' + i + s).css('pointer-events', 'none');

                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/checked.png" title ="已完成" value="1">');
                                    $('#details_zipause' + i + s).html('<img src="/img/kb.png" title ="已完成" value="11">');
                                    $('#details_zipause' + i + s).css('pointer-events', 'none');
                                    details_hhhh(i, s)
                                    task_appendto(i) //如果成功，则返回

                                    sub_hhhh(i, s)

                                    tmp_hhhh(i, s) //临时stand子任务
                                    $('#wd-details-sub-hhhh' + i + s).hide();
                                    $('#wd-details-sub-hhhh-tmp' + i + s).hide();
                                    let numval = $('#wd-details-sub-fins-close' + i).text()
                                    let numa = numval.split('/')
                                    // 当一个子任务完成，其他的子任务都是暂停时，父任务也暂停
                                    if (details_zhuzi(i, s) == -1) {
                                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#pause' + i).css('pointer-events', '');

                                        $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#details_pause' + i).css('pointer-events', '');
                                        // 当子任务是最后一个完成的子任务时，父任务自动完成
                                        if (details_zirenwuok(i, s) == '-1') {
                                            $('#pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                                            $('#zrw' + i).html('<img  src="/img/checked.png" title ="已完成" value="1">');
                                            $('#pause' + i).css('pointer-events', 'none');

                                            $('#details_pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                                            $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                                            $('#details_pause' + i).css('pointer-events', 'none');
                                            hhhh(i)
                                            details_hhhh(i, s)
                                            task_returnto(i)

                                            details_use_hide(i)
                                            $('#wd-details-sub-hhhh' + i + s).hide();
                                            $('#wd-details-sub-hhhh-tmp' + i + s).hide();
                                            // $('#zrw'+k).css('pointer-events','none');
                                        }
                                    }

                                    task_details_sub_appendto(i, s)
                                    let fractional = (detailsfs(i)) + '/' + String(numa[1])
                                    $('#wd-stand-sub_stat' + i).html(fractional)
                                    $('#wd-stand-sub_statclose' + i).html(fractional)

                                    $('#wd-details-sub-fins-open' + i).html(fractional)
                                    $('#wd-details-sub-fins-close' + i).html(fractional)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                }
                            })
                        }, 700);
                    } else {
                        setTimeout(function () {
                            $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/loading.gif" title ="等待中">');
                            allsubbbox(i, s)
                        });
                        setTimeout(function () {
                            sub_Reopen(Sub_id, function (err, data) {
                                if (err) {
                                    layer.msg(err)
                                    return
                                }
                                allsubbbox_xing(i, s)
                                if (data.state == 1) {
                                    layer.msg(data.msg)
                                    // 子任务重新打开时，改为未选中状态的图标
                                    $('#cboxid' + i + s).html('<img style="width: 17px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                    // 子任务重新打开时，显示开始暂停按钮
                                    $('#zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#zipause' + i + s).css('pointer-events', '');

                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/uncheck.png" title ="未完成" value="0">');
                                    // 子任务重新打开时，显示开始暂停按钮
                                    $('#details_zipause' + i + s).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                    $('#details_zipause' + i + s).css('pointer-events', '');


                                    sub_ssss(i, s)
                                    tmp_ssss(i, s)
                                    let numval = $('#wd-details-sub-fins-close' + i).text()
                                    let numa = numval.split('/')
                                    // 子任务重新打开时，父任务重新打开，并且显示父任务的开始暂停按钮
                                    if (details_zhuzi(i, s) == -1) {
                                        $('#zrw' + i).html('<img src="/img/uncheck.png" title ="未完成" value="0">');
                                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#pause' + i).css('pointer-events', '');

                                        $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/uncheck.png" title ="未完成" value="0">');
                                        $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                                        $('#details_pause' + i).css('pointer-events', '');

                                        $('#wd-stand-sub-hhhh' + i + s).show();
                                        $('#wd-details-sub-hhhh' + i + s).show();
                                        $('#wd-details-sub-hhhh-tmp' + i + s).show();
                                        ssss(i)
                                        details_ssss(i, s)
                                        details_use_show(i)
                                    }
                                    details_ssss(i, s)
                                    task_appendto(i)
                                    task_details_sub_prependTo(i, s)
                                    $('#wd-details-sub-hhhh' + i + s).show();
                                    $('#wd-details-sub-hhhh-tmp' + i + s).show();
                                    let fractional = (detailsfs(i)) + '/' + String(numa[1])
                                    $('#wd-stand-sub_stat' + i).html(fractional)
                                    $('#wd-stand-sub_statclose' + i).html(fractional)

                                    $('#wd-details-sub-fins-open' + i).html(fractional)
                                    $('#wd-details-sub-fins-close' + i).html(fractional)
                                }
                                if (data.state == 0) {
                                    layer.msg(data.msg)
                                    $('#details_cboxid' + i + s).html('<img style="width: 17px;"  src="/img/checked.png" title ="已完成" value="1">');
                                }
                            })
                        }, 700);
                    }
                }
                function details_zirenwuok(i, s) {

                    var rrr = new Array();
                    // $('#zipause'+k+i).html('<img src="/img/blue_begin.png" value="1">');
                    let arr = $('#wd-task-details-suball' + i + ' .complete img');
                    for (let j = 0; j < arr.length; j++) {
                        rrr.push(arr[j].getAttribute('value'));
                    }
                    let index = rrr.indexOf('0');
                    return index
                }
                // 如果删除之后，子任务没有可完成的，则任务自动为完成
                function stand_details_fun(i, s) {
                    if (details_zhuzi(i, s) == -1) {
                        $('#details_pause' + i).html('<img style="width: 15px;" src="/img/blue_begin.png" title ="暂停中" value="1">');
                        $('#details_pause' + i).css('pointer-events', '');
                        // 当子任务是最后一个完成的子任务时，父任务自动完成
                        if (details_zirenwuok(i, s) == '-1') {
                            $('#details_pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                            $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                            $('#details_pause' + i).css('pointer-events', 'none');
                            hhhh(i)
                            details_hhhh(i, s)
                            task_returnto(i)
                            $('#wd-details-sub-hhhh' + i + s).hide();
                            $('#wd-details-sub-hhhh-tmp' + i + s).hide();
                            // $('#zrw'+k).css('pointer-events','none');
                        }
                    }

                    if (zhuzi(i, s) == -1) {
                        $('#pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                        $('#pause' + i).css('pointer-events', '');

                        $('#details_pause' + i).html('<img src="/img/blue_begin.png" title ="暂停中" value="1">');
                        $('#details_pause' + i).css('pointer-events', '');
                        // 当子任务是最后一个完成的子任务时，父任务自动完成
                        if (zirenwuok(i, s) == '-1') {
                            $('#pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                            $('#zrw' + i).html('<img  src="/img/checked.png" title ="已完成" value="1">');
                            $('#pause' + i).css('pointer-events', 'none');

                            $('#details_pause' + i).html('<img src="/img/kb.png" title ="空白" value="11">');
                            $('#details_zrw' + i).html('<img style="width: 32px;" src="/img/checked.png" title ="已完成" value="1">');
                            $('#details_pause' + i).css('pointer-events', 'none');
                            task_returnto(i) //如果点击完成，添加到最下面
                            hhhh(i)
                            sub_hhhh(i, s)
                            tmp_hhhh(i, s)
                            // $('#zrw'+k).css('pointer-events','none');
                        }
                    }
                }
            </script>
</body>
</div>

<!-- <div class="dele_task">
     <div class="wd-task-state">
            <div class="wd-task-state-left">
                <img src="/img/Task/left.png" title="点击显示">
                <label style="position: relative;top: 2px;cursor: pointer;" for="">(完成的任务)</label>
            </div>
            <div class="wd-task-state-bottom">
                <img src="/img/Task/bottom.png" title="点击隐藏">
            </div>
        </div>
    <div class="wd-task-three">

    </div>
</div> -->
<!-- <div class="wd-cheng-dell">
    
</div> -->
</div>
<div style="width:100%;height:30px;"></div>

</html>

<script>
    laydate.render({
        elem: '#c1'
    });
    laydate.render({
        elem: '.wd-stand-sub-append'
    });
</script>
<style>
    a {
        color: #999999;
    }
</style>