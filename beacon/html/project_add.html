{{define "layout"}}
<!DOCTYPE html>
<html>

<body>
    <!--head-->
    {{.}}

    {{ end }}
    {{ template "head"}}
    <title>创建项目</title>
    <div id="add" class="container">
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm layuiAddform">
            <el-form-item label="项目名称" prop="name">
                <el-input v-model="ruleForm.name"></el-input>
            </el-form-item>

            <el-form-item label="项目类型" prop="radio">
                <el-radio-group v-model="ruleForm.radio">
                    <el-radio label="1">标准项目</el-radio>
                    <el-radio label="2">看板项目</el-radio>
                </el-radio-group>
            </el-form-item>

            <el-form-item label="项目成员">
                <el-checkbox :indeterminate="isIndeterminate" v-model="checkAll" @change="handleCheckAllChange">全选
                </el-checkbox>

                <el-checkbox-group v-model="ruleForm.checkedCities" @change="handleCheckedCitiesChange">
                    <el-checkbox v-for="mmb in mmbers" :label="mmb.id" :key="mmb.id">${mmb.name}</el-checkbox>
                </el-checkbox-group>
            </el-form-item>

            <el-form-item label="项目标签">
                <el-tag :key="tag" v-for="tag in dynamicTags" closable :disable-transitions="false"
                    @close="handleClose(tag)">
                    ${tag}
                </el-tag>
                <el-input class="input-new-tag" v-if="inputVisible" v-model="inputValue" ref="saveTagInput" size="small"
                    @keyup.enter.native="handleInputConfirm" @blur="handleInputConfirm">
                </el-input>
                <el-button v-else class="button-new-tag" size="small" @click="showInput">+ New Tag</el-button>
            </el-form-item>

            <el-form-item label="项目描述" prop="text">
                <el-input type="textarea" v-model="ruleForm.text"></el-input>
            </el-form-item>

            <el-form-item>
                <el-button type="primary" @click="submitForm('ruleForm')">立即创建</el-button>
                <el-button @click="resetForm('ruleForm')">重置</el-button>
            </el-form-item>
   
        </el-form>

    </div>
</body>
<style>
    .container {
        background-color: rgba(255, 255, 255, 0.932)
    }

    .el-tag+.el-tag {
        margin-left: 10px;
    }

    .button-new-tag {
        margin-left: 10px;
        height: 32px;
        line-height: 30px;
        padding-top: 0;
        padding-bottom: 0;
    }

    .input-new-tag {
        width: 90px;
        margin-left: 10px;
        vertical-align: bottom;
    }
</style>
<script>
    var add = new Vue({
        delimiters: ['${', '}'],
        el: '#add',
        data() {
            return {
                mmbers: [], //所有成员

                ruleForm: {
                    name: '', //名称
                    radio: '1', //类型
                    text: '',
                    checkedCities: []
                },
                rules: {
                    name: [{
                            required: true,
                            message: '请输入项目名称',
                            trigger: 'blur'
                        },
                        {
                            min: 3,
                            max: 12,
                            message: '长度在 3 到 12 个字符',
                            trigger: 'blur'
                        }
                    ],
                    radio: [{
                        required: false,
                        message: '请选择项目类型',
                        trigger: 'change'
                    }],
                    text: [{
                        required: false,
                        message: '你也可以不输入项目描述',
                        trigger: 'change'
                    }],
                },
                checkAll: false,
                isIndeterminate: false,

                dynamicTags: ['标签一', '标签二', '标签三'],
                inputVisible: false,
                inputValue: '',
            }
        },
        methods: {
            submitForm(formName) {
                // this.$refs[formName].validate((valid) => {
                //     if (valid) {
                //         console.log(this.ruleForm)
                //     } else {
                //         console.log('error submit!!');
                //         return false;
                //     }
                // });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleClose(tag) {
                this.dynamicTags.splice(this.dynamicTags.indexOf(tag), 1);
            },

            showInput() {
                this.inputVisible = true;
                this.$nextTick(_ => {
                    this.$refs.saveTagInput.$refs.input.focus();
                });
            },

            handleInputConfirm() {
                let inputValue = this.inputValue;
                if (inputValue) {
                    this.dynamicTags.push(inputValue);
                }
                this.inputVisible = false;
                this.inputValue = '';
            },
            
            handleCheckAllChange(val) {
                // console.log(this.mmbers)
                console.log(val)
                console.log(this.ruleForm.checkedCities)
                this.ruleForm.checkedCities = val ? this.mmbers : [];
                this.isIndeterminate = false;
            },
            handleCheckedCitiesChange(value) {
                
                let checkedCount = value.length;
                this.checkAll = checkedCount === this.mmbers.length;
                this.isIndeterminate = checkedCount > 0 && checkedCount < this.mmbers.length;
            },

        },
        mounted() {
            axios.get('/member/all') .then(function (response) {
                    if (response.data.data) {
                        add.mmbers =  response.data.data.map(item => {
                            var id = decodeURIComponent(Object.keys(item)[0]); //Object.keys方法，返回数组键值
                            var name = decodeURIComponent(item[id])
                            return {
                                'id': id,
                                'name': name
                            }
                        })
                    }
                })
                .catch(function (error) {
                    console.log(error);
                });
              
        }
    })
</script>

</html>